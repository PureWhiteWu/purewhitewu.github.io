<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="https://static.purewhite.io/favicon.jpg"><link rel="icon" type="image/png" sizes="32x32" href="https://static.purewhite.io/favicon.jpg"><link rel="icon" type="image/png" sizes="16x16" href="https://static.purewhite.io/favicon.jpg"><link rel="mask-icon" href="https://static.purewhite.io/favicon.jpg" color="#222"><meta name="google-site-verification" content="Xg_Hnp9ie-Rq7-zLPdd3c9dQtR_0N845ue4QaK8jvL4"><meta name="baidu-site-verification" content="c3b074df19d33f893845b6d092bc9169"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.purewhite.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"ZP9482CZD3","apiKey":"d26207a3ce8de9fe98e7af4215425c93","indexName":"Blog","hits":{"per_page":10}}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/config.min.js"></script><meta name="description" content="最近 Rust 官方社区搞了个 Rustc Reading Club 的活动，由编译器 team 的 Leader Niko 发起，具体网址在这里：https:&#x2F;&#x2F;rust-lang.github.io&#x2F;rustc-reading-club&#x2F; 很可惜的是，11 月 4 日的第一期，由于太过火爆并且 Zoom 人数限制 100 人，导致主持人 Niko 自己进不来所以取消了……等待看看官方后续会怎么"><meta property="og:type" content="article"><meta property="og:title" content="Rustc Reading Club：从一个错误出发学习 rustc_resolve"><meta property="og:url" content="https://www.purewhite.io/2021/11/07/rustc-resolve-reading-defined-multiple-times/index.html"><meta property="og:site_name" content="Pure White"><meta property="og:description" content="最近 Rust 官方社区搞了个 Rustc Reading Club 的活动，由编译器 team 的 Leader Niko 发起，具体网址在这里：https:&#x2F;&#x2F;rust-lang.github.io&#x2F;rustc-reading-club&#x2F; 很可惜的是，11 月 4 日的第一期，由于太过火爆并且 Zoom 人数限制 100 人，导致主持人 Niko 自己进不来所以取消了……等待看看官方后续会怎么"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107173520665-Xcw2lU.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107184148779-Rk3CR3.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107184650136-uds41e.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107184758563-03lWsz.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107185222063-iGSng1.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107191451777-uOrrh7.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107191616859-Q69Ns3.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107191702182-edhbmZ.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107191746171-295pM4.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107191616859-Q69Ns3.png!webp_90"><meta property="og:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107192704528-TJIrs5.png!webp_90"><meta property="article:published_time" content="2021-11-07T07:38:31.000Z"><meta property="article:modified_time" content="2021-12-02T12:51:07.000Z"><meta property="article:author" content="Pure White"><meta property="article:tag" content="rust"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://static.purewhite.io/uPic/2021-11-07/image-20211107173520665-Xcw2lU.png!webp_90"><link rel="canonical" href="https://www.purewhite.io/2021/11/07/rustc-resolve-reading-defined-multiple-times/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.purewhite.io/2021/11/07/rustc-resolve-reading-defined-multiple-times/","path":"2021/11/07/rustc-resolve-reading-defined-multiple-times/","title":"Rustc Reading Club：从一个错误出发学习 rustc_resolve"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Rustc Reading Club：从一个错误出发学习 rustc_resolve | Pure White</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98194081-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-98194081-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/analytics/google-analytics.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/analytics/baidu-analytics.min.js"></script><script async src="https://hm.baidu.com/hm.js?587d2548655f9855727225afb0e4d708"></script><script async src="//assets.growingio.com/2.1/gio.js"></script><script class="next-config" data-name="growingio_analytics" type="application/json">"8a8c3a537a0132ac"</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/analytics/growingio.min.js"></script><script type="text/javascript">!function(t,e,n,a,c,s,i){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(s=e.createElement(a)).async=1,s.src="https://www.clarity.ms/tag/8mh5xasia9",(i=e.getElementsByTagName(a)[0]).parentNode.insertBefore(s,i)}(window,document,"clarity","script")</script><script>!function(){var e=document.createElement("script");e.src="https://lf1-cdn-tos.bytegoofy.com/goofy/ttzz/push.js?c75fd468cb92e13256468f9ae3917db97049a5a91566914dbb6ab879288745b8bc434964556b7d7129e9b750ed197d397efd7b0c6c715c1701396e1af40cec962b8d7c8c6655c9b00211740aa8a98e2e",e.id="ttzz";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(e,c)}(window)</script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Pure White" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="Pure White" type="application/rss+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Pure White</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">主业写bug，副业debug</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-关于我"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于我</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="algolia-stats"><hr></div><div class="algolia-hits"></div><div class="algolia-pagination"></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.</span> <span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8E%E9%94%99%E8%AF%AF%E5%87%BA%E5%8F%91"><span class="nav-number">2.</span> <span class="nav-text">从错误出发</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Pure White" src="https://static.purewhite.io/avatar.jpg!webp_90"><p class="site-author-name" itemprop="name">Pure White</p><div class="site-description" itemprop="description">青春不是年华，是心境；<br>青春不是桃面、丹唇、柔膝，<br>而是深沉的意志、恢弘的想象、<br>炽热的感情。</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">59</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">14</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/PureWhiteWu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PureWhiteWu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:me@purewhite.io" title="E-Mail → mailto:me@purewhite.io" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://twitter.com/PureWhite_Wu" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;PureWhite_Wu" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i> Twitter</a></span><span class="links-of-author-item"><a href="https://www.linkedin.com/in/%E8%BF%AA-%E5%90%B4-846051106/" title="LinkedIn → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;%E8%BF%AA-%E5%90%B4-846051106&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-linkedin fa-fw"></i> LinkedIn</a></span><span class="links-of-author-item"><a href="https://telegram.me/PureWhiteWu" title="Telegram → https:&#x2F;&#x2F;telegram.me&#x2F;PureWhiteWu" rel="noopener me" target="_blank"><i class="fa fa-telegram fa-fw"></i> Telegram</a></span><span class="links-of-author-item"><a href="http://weibo.com/purewhitewu" title="微博 → http:&#x2F;&#x2F;weibo.com&#x2F;purewhitewu" rel="noopener me" target="_blank"><i class="fa fa-weibo fa-fw"></i> 微博</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/PureWhite_Wu" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;PureWhite_Wu" rel="noopener me" target="_blank"><i class="fa fa-book fa-fw"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://static.purewhite.io/wechat_channel.jpg" title="微信 → https:&#x2F;&#x2F;static.purewhite.io&#x2F;wechat_channel.jpg" rel="noopener me" target="_blank"><i class="fa fa-weixin fa-fw"></i> 微信</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://www.didispace.com/" title="https:&#x2F;&#x2F;www.didispace.com&#x2F;" rel="noopener" target="_blank">程序猿DD</a></li><li class="links-of-blogroll-item"> <a href="https://www.v2ex.com/?r=PureWhiteWu" title="https:&#x2F;&#x2F;www.v2ex.com&#x2F;?r&#x3D;PureWhiteWu" rel="noopener" target="_blank">v2ex</a></li><li class="links-of-blogroll-item"> <a href="https://yuzhouwan.com/" title="https:&#x2F;&#x2F;yuzhouwan.com&#x2F;" rel="noopener" target="_blank">宇宙湾</a></li><li class="links-of-blogroll-item"> <a href="https://www.ibyte.me/" title="https:&#x2F;&#x2F;www.ibyte.me&#x2F;" rel="noopener" target="_blank">Leon Ding</a></li></ul></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.purewhite.io/2021/11/07/rustc-resolve-reading-defined-multiple-times/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://static.purewhite.io/avatar.jpg!webp_90"><meta itemprop="name" content="Pure White"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Pure White"><meta itemprop="description" content="青春不是年华，是心境；<br />青春不是桃面、丹唇、柔膝，<br />而是深沉的意志、恢弘的想象、<br />炽热的感情。"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Rustc Reading Club：从一个错误出发学习 rustc_resolve | Pure White"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Rustc Reading Club：从一个错误出发学习 rustc_resolve</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-11-07 15:38:31" itemprop="dateCreated datePublished" datetime="2021-11-07T15:38:31+08:00">2021-11-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-12-02 20:51:07" itemprop="dateModified" datetime="2021-12-02T20:51:07+08:00">2021-12-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/rust/" itemprop="url" rel="index"><span itemprop="name">rust</span></a></span></span><span id="/2021/11/07/rustc-resolve-reading-defined-multiple-times/" class="post-meta-item leancloud_visitors" data-flag-title="Rustc Reading Club：从一个错误出发学习 rustc_resolve" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Disqus：</span><a title="disqus" href="/2021/11/07/rustc-resolve-reading-defined-multiple-times/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/11/07/rustc-resolve-reading-defined-multiple-times/" itemprop="commentCount"></span></a></span><span class="post-meta-break"></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.1k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>11 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>最近 Rust 官方社区搞了个 Rustc Reading Club 的活动，由编译器 team 的 Leader Niko 发起，具体网址在这里：<a target="_blank" rel="noopener" href="https://rust-lang.github.io/rustc-reading-club/">https://rust-lang.github.io/rustc-reading-club/</a></p><p>很可惜的是，11 月 4 日的第一期，由于太过火爆并且 Zoom 人数限制 100 人，导致主持人 Niko 自己进不来所以取消了……等待看看官方后续会怎么搞吧，还是很期待官方组织的活动的。</p><p>Rust 中文社群的张汉东大佬也紧跟着官方的活动，在社群里面组织了 Rustc 源码阅读的活动，今天（11 月 7 日）举办了第一期，在这期中我跟着吴翱翔大佬的思路，从一个错误出发，学习了一部分 rustc_resolve 的逻辑，于是想着写一篇博客总结一下。</p><p>【小广告】下一期 11 月 14 日下午会由刘翼飞大佬带领大家一起去阅读类型推导相关的代码，有兴趣的同学可以下载<a target="_blank" rel="noopener" href="https://www.feishu.cn/">飞书</a>，注册一个个人账号，然后扫描二维码加入：</p><span id="more"></span> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107173520665-Xcw2lU.png!webp_90" alt="Rust 中文社群" style="zoom:25%"><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>言归正传，在阅读 Rustc 源代码之前，我们需要先做一些准备工作，主要是先 clone 下来 Rust 的代码，然后配置好 IDE（虽然但是，Clion 到现在正式版还不支持远程，EAP 又各种 bug……），具体可以参考官方的 guide：<a target="_blank" rel="noopener" href="https://rustc-dev-guide.rust-lang.org/getting-started.html%E3%80%82%E8%B7%9F%E7%9D%80%E8%BF%99%E7%AB%A0%E5%81%9A%E5%AE%8C%E5%B0%B1%E8%A1%8C%EF%BC%9Ahttps://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html%E3%80%82">https://rustc-dev-guide.rust-lang.org/getting-started.html。跟着这章做完就行：https://rustc-dev-guide.rust-lang.org/building/how-to-build-and-run.html。</a></p><h1 id="从错误出发"><a href="#从错误出发" class="headerlink" title="从错误出发"></a>从错误出发</h1><p>这次我们的阅读主要的对象是<code>rustc_resolve</code>，顾名思义应该是做名称解析的，更加详细的信息可以来这瞅一眼：<a target="_blank" rel="noopener" href="https://rustc-dev-guide.rust-lang.org/name-resolution.html%E3%80%82">https://rustc-dev-guide.rust-lang.org/name-resolution.html。</a></p><p>我们打开<code>rustc_resolve</code>的<code>lib.rs</code>一看，妈呀，光这个文件就接近 4000 行代码，直接这么硬看肯定不现实；不过吴翱翔大佬提出了一个思路：从一个我们最常见的错误<code>the name xx is defined multiple times</code>出发，顺着这条路去学习一下相关的代码。</p><p>这是一个很好的办法，当你不知道从哪入手的时候，你可以构造一个场景，由点切入，最终由点及面看完所有代码。</p><p>废话少说，我们先祭出搜索大法，在<code>rustc_resolve</code>里面搜一下这个错误是在哪出现的：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107184148779-Rk3CR3.png!webp_90" alt="查找这个错误" style="zoom:50%"><p>非常巧，正好就在<code>rustc_resolve</code>的<code>lib.rs</code>中，于是我们跳转过去，发现确实是这个我们想找的错误：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">msg</span> = <span class="built_in">format!</span>(<span class="string">&quot;the name `&#123;&#125;` is defined multiple times&quot;</span>, name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">err</span> = <span class="keyword">match</span> (old_binding.<span class="title function_ invoke__">is_extern_crate</span>(), new_binding.<span class="title function_ invoke__">is_extern_crate</span>()) &#123;</span><br><span class="line">    (<span class="literal">true</span>, <span class="literal">true</span>) =&gt; struct_span_err!(<span class="keyword">self</span>.session, span, E0259, <span class="string">&quot;&#123;&#125;&quot;</span>, msg),</span><br><span class="line">    (<span class="literal">true</span>, _) | (_, <span class="literal">true</span>) =&gt; <span class="keyword">match</span> new_binding.<span class="title function_ invoke__">is_import</span>() &amp;&amp; old_binding.<span class="title function_ invoke__">is_import</span>() &#123;</span><br><span class="line">        <span class="literal">true</span> =&gt; struct_span_err!(<span class="keyword">self</span>.session, span, E0254, <span class="string">&quot;&#123;&#125;&quot;</span>, msg),</span><br><span class="line">        <span class="literal">false</span> =&gt; struct_span_err!(<span class="keyword">self</span>.session, span, E0260, <span class="string">&quot;&#123;&#125;&quot;</span>, msg),</span><br><span class="line">    &#125;,</span><br><span class="line">    _ =&gt; <span class="keyword">match</span> (old_binding.<span class="title function_ invoke__">is_import</span>(), new_binding.<span class="title function_ invoke__">is_import</span>()) &#123;</span><br><span class="line">        (<span class="literal">false</span>, <span class="literal">false</span>) =&gt; struct_span_err!(<span class="keyword">self</span>.session, span, E0428, <span class="string">&quot;&#123;&#125;&quot;</span>, msg),</span><br><span class="line">        (<span class="literal">true</span>, <span class="literal">true</span>) =&gt; struct_span_err!(<span class="keyword">self</span>.session, span, E0252, <span class="string">&quot;&#123;&#125;&quot;</span>, msg),</span><br><span class="line">        _ =&gt; struct_span_err!(<span class="keyword">self</span>.session, span, E0255, <span class="string">&quot;&#123;&#125;&quot;</span>, msg),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>所在的这个函数名也正好是<code>report_conflict</code>，完美！</p><p>让我们接着看看这个函数在哪被调用到了：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107184650136-uds41e.png!webp_90" alt="report_conflict" style="zoom:67%"><p>这个函数除了定义外，被调用到了两次，其中下面这次是在自己函数内部递归调用，我们直接无视掉；还有一次是在<code>build_reduced_graph.rs</code>中，让我们跟着去看看：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107184758563-03lWsz.png!webp_90" alt="build_reduced_graph.rs" style="zoom:67%"><p>在这里是被<code>define</code>方法调用到，看着很符合预期，看来我们找对地方了。</p><p>这段代码先通过<code>to_name_binding</code>方法把传入的<code>def</code>转换成一个<code>NameBinding</code>，让我们看看这段干了啥：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107185222063-iGSng1.png!webp_90" alt="NameBinding" style="zoom:67%"><p><code>NameBinding</code>是一个记录了一个值、类型或者模块定义的结构体，其中<code>kind</code>我们大胆猜测是类型，<code>ambiguity</code>看不懂先放着，<code>expansion</code>也是（如果看过 rustc-dev-guide 能大致知道是和卫生宏展开有关，这里我们也先无视），然后是<code>span</code>也不知道干啥的，点进去研究下感觉和增量编译有关，也先放着，最后<code>vis</code>估摸着应该表示的是可见性。</p><p>然后我们再点<code>ResolverArenas</code>看看是干啥的：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Nothing really interesting here; it just provides memory for the rest of the crate.</span></span><br><span class="line"><span class="meta">#[derive(Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">ResolverArenas</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>嗯，好，没啥值得关注的，只是用来提供内存的，直接无视。</p><p>我们再接着回到上面的<code>define</code>方法中：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>&gt; Resolver&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/// Defines `name` in namespace `ns` of module `parent` to be `def` if it is not yet defined;</span></span><br><span class="line">    <span class="comment">/// otherwise, reports an error.</span></span><br><span class="line">    <span class="keyword">crate</span> <span class="keyword">fn</span> <span class="title function_">define</span>&lt;T&gt;(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, parent: Module&lt;<span class="symbol">&#x27;a</span>&gt;, ident: Ident, ns: Namespace, def: T)</span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">        T: ToNameBinding&lt;<span class="symbol">&#x27;a</span>&gt;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">binding</span> = def.<span class="title function_ invoke__">to_name_binding</span>(<span class="keyword">self</span>.arenas);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">key</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">new_key</span>(ident, ns);</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(old_binding) = <span class="keyword">self</span>.<span class="title function_ invoke__">try_define</span>(parent, key, binding) &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="title function_ invoke__">report_conflict</span>(parent, ident, ns, old_binding, &amp;binding);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二句<code>let key = self.new_key(ident, ns);</code>看着也没啥特殊的，就是根据当前所在的<code>namespace</code>给<code>ident</code>（表示标识符）新建一个<code>key</code>，那么 value 应该就是上面的<code>binding</code>了。</p><p>然后这里调用了<code>try_define</code>，如果返回了 Err 就调用<code>report_conflict</code>，让我们接着进入<code>try_define</code>看看（先不用仔细看）：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Define the name or return the existing binding if there is a collision.</span></span><br><span class="line"><span class="keyword">crate</span> <span class="keyword">fn</span> <span class="title function_">try_define</span>(</span><br><span class="line">    &amp;<span class="keyword">mut</span> <span class="keyword">self</span>,</span><br><span class="line">    module: Module&lt;<span class="symbol">&#x27;a</span>&gt;,</span><br><span class="line">    key: BindingKey,</span><br><span class="line">    binding: &amp;<span class="symbol">&#x27;a</span> NameBinding&lt;<span class="symbol">&#x27;a</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), &amp;<span class="symbol">&#x27;a</span> NameBinding&lt;<span class="symbol">&#x27;a</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">res</span> = binding.<span class="title function_ invoke__">res</span>();</span><br><span class="line">    <span class="keyword">self</span>.<span class="title function_ invoke__">check_reserved_macro_name</span>(key.ident, res);</span><br><span class="line">    <span class="keyword">self</span>.<span class="title function_ invoke__">set_binding_parent_module</span>(binding, module);</span><br><span class="line">    <span class="keyword">self</span>.<span class="title function_ invoke__">update_resolution</span>(module, key, |this, resolution| &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(old_binding) = resolution.binding &#123;</span><br><span class="line">            <span class="keyword">if</span> res == Res::<span class="literal">Err</span> &#123;</span><br><span class="line">                <span class="comment">// Do not override real bindings with `Res::Err`s from error recovery.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">Ok</span>(());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">match</span> (old_binding.<span class="title function_ invoke__">is_glob_import</span>(), binding.<span class="title function_ invoke__">is_glob_import</span>()) &#123;</span><br><span class="line">                (<span class="literal">true</span>, <span class="literal">true</span>) =&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> res != old_binding.<span class="title function_ invoke__">res</span>() &#123;</span><br><span class="line">                        resolution.binding = <span class="title function_ invoke__">Some</span>(this.<span class="title function_ invoke__">ambiguity</span>(</span><br><span class="line">                            AmbiguityKind::GlobVsGlob,</span><br><span class="line">                            old_binding,</span><br><span class="line">                            binding,</span><br><span class="line">                        ));</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> !old_binding.vis.<span class="title function_ invoke__">is_at_least</span>(binding.vis, &amp;*this) &#123;</span><br><span class="line">                        <span class="comment">// We are glob-importing the same item but with greater visibility.</span></span><br><span class="line">                        resolution.binding = <span class="title function_ invoke__">Some</span>(binding);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                (old_glob @ <span class="literal">true</span>, <span class="literal">false</span>) | (old_glob @ <span class="literal">false</span>, <span class="literal">true</span>) =&gt; &#123;</span><br><span class="line">                    <span class="keyword">let</span> (glob_binding, nonglob_binding) =</span><br><span class="line">                        <span class="keyword">if</span> old_glob &#123; (old_binding, binding) &#125; <span class="keyword">else</span> &#123; (binding, old_binding) &#125;;</span><br><span class="line">                    <span class="keyword">if</span> glob_binding.<span class="title function_ invoke__">res</span>() != nonglob_binding.<span class="title function_ invoke__">res</span>()</span><br><span class="line">                        &amp;&amp; key.ns == MacroNS</span><br><span class="line">                        &amp;&amp; nonglob_binding.expansion != LocalExpnId::ROOT</span><br><span class="line">                    &#123;</span><br><span class="line">                        resolution.binding = <span class="title function_ invoke__">Some</span>(this.<span class="title function_ invoke__">ambiguity</span>(</span><br><span class="line">                            AmbiguityKind::GlobVsExpanded,</span><br><span class="line">                            nonglob_binding,</span><br><span class="line">                            glob_binding,</span><br><span class="line">                        ));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        resolution.binding = <span class="title function_ invoke__">Some</span>(nonglob_binding);</span><br><span class="line">                    &#125;</span><br><span class="line">                    resolution.shadowed_glob = <span class="title function_ invoke__">Some</span>(glob_binding);</span><br><span class="line">                &#125;</span><br><span class="line">                (<span class="literal">false</span>, <span class="literal">false</span>) =&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(old_binding);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolution.binding = <span class="title function_ invoke__">Some</span>(binding);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看着比较长，让我们一点一点来。</p><p>第一句<code>let res = binding.res();</code>就有点懵了，<code>res</code>是啥？result？response？其实都不是，我们点进去看看，一直点到底，会发现其实是<code>resolution</code>的缩写：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// The resolution of a path or export.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// For every path or identifier in Rust, the compiler must determine</span></span><br><span class="line"><span class="comment">/// what the path refers to. This process is called name resolution,</span></span><br><span class="line"><span class="comment">/// and `Res` is the primary result of name resolution.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// For example, everything prefixed with `/* Res */` in this example has</span></span><br><span class="line"><span class="comment">/// an associated `Res`:</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// ```</span></span><br><span class="line"><span class="comment">/// fn str_to_string(s: &amp; /* Res */ str) -&gt; /* Res */ String &#123;</span></span><br><span class="line"><span class="comment">///     /* Res */ String::from(/* Res */ s)</span></span><br><span class="line"><span class="comment">/// &#125;</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// /* Res */ str_to_string(&quot;hello&quot;);</span></span><br><span class="line"><span class="comment">/// ```</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// The associated `Res`s will be:</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - `str` will resolve to [`Res::PrimTy`];</span></span><br><span class="line"><span class="comment">/// - `String` will resolve to [`Res::Def`], and the `Res` will include the [`DefId`]</span></span><br><span class="line"><span class="comment">///   for `String` as defined in the standard library;</span></span><br><span class="line"><span class="comment">/// - `String::from` will also resolve to [`Res::Def`], with the [`DefId`]</span></span><br><span class="line"><span class="comment">///   pointing to `String::from`;</span></span><br><span class="line"><span class="comment">/// - `s` will resolve to [`Res::Local`];</span></span><br><span class="line"><span class="comment">/// - the call to `str_to_string` will resolve to [`Res::Def`], with the [`DefId`]</span></span><br><span class="line"><span class="comment">///   pointing to the definition of `str_to_string` in the current crate.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#[derive(Clone, Copy, PartialEq, Eq, Encodable, Decodable, Hash, Debug)]</span></span><br><span class="line"><span class="meta">#[derive(HashStable_Generic)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Res</span>&lt;Id = hir::HirId&gt; &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好的，这条语句就是获得了我们刚才初始化的<code>binding</code>的<code>resolution</code>，我们接着看：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.<span class="title function_ invoke__">check_reserved_macro_name</span>(key.ident, res);</span><br><span class="line"><span class="keyword">self</span>.<span class="title function_ invoke__">set_binding_parent_module</span>(binding, module);</span><br></pre></td></tr></table></figure><p>先看第一行的<code>check_reserved_macro_name</code>：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">crate</span> <span class="keyword">fn</span> <span class="title function_">check_reserved_macro_name</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, ident: Ident, res: Res) &#123;</span><br><span class="line">    <span class="comment">// Reserve some names that are not quite covered by the general check</span></span><br><span class="line">    <span class="comment">// performed on `Resolver::builtin_attrs`.</span></span><br><span class="line">    <span class="keyword">if</span> ident.name == sym::cfg || ident.name == sym::cfg_attr &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">macro_kind</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">get_macro</span>(res).<span class="title function_ invoke__">map</span>(|ext| ext.<span class="title function_ invoke__">macro_kind</span>());</span><br><span class="line">        <span class="keyword">if</span> macro_kind.<span class="title function_ invoke__">is_some</span>() &amp;&amp; <span class="title function_ invoke__">sub_namespace_match</span>(macro_kind, <span class="title function_ invoke__">Some</span>(MacroKind::Attr)) &#123;</span><br><span class="line">            <span class="keyword">self</span>.session.<span class="title function_ invoke__">span_err</span>(</span><br><span class="line">                ident.span,</span><br><span class="line">                &amp;<span class="built_in">format!</span>(<span class="string">&quot;name `&#123;&#125;` is reserved in attribute namespace&quot;</span>, ident),</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好像也没啥特殊的，就是看看有没有用到保留关键字，先无视掉吧；</p><p>再看看第二行<code>set_binding_parent_module</code>：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">set_binding_parent_module</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, binding: &amp;<span class="symbol">&#x27;a</span> NameBinding&lt;<span class="symbol">&#x27;a</span>&gt;, module: Module&lt;<span class="symbol">&#x27;a</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(old_module) = <span class="keyword">self</span>.binding_parent_modules.<span class="title function_ invoke__">insert</span>(<span class="title function_ invoke__">PtrKey</span>(binding), module) &#123;</span><br><span class="line">        <span class="keyword">if</span> !ptr::<span class="title function_ invoke__">eq</span>(module, old_module) &#123;</span><br><span class="line">            span_bug!(binding.span, <span class="string">&quot;parent module is reset for binding&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>hmmm……好像是绑定了所在的 module，看着也没啥特殊的，也跳过吧。</p><p>接着往下看，这一段是重头戏了，让我们先进入<code>update_resolution</code>看看：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107191451777-uOrrh7.png!webp_90" alt="update_resolution" style="zoom:67%"><p>这里我们只关注：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">resolution</span> = &amp;<span class="keyword">mut</span> *<span class="keyword">self</span>.<span class="title function_ invoke__">resolution</span>(module, key).<span class="title function_ invoke__">borrow_mut</span>();</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">t</span> = <span class="title function_ invoke__">f</span>(<span class="keyword">self</span>, resolution);</span><br></pre></td></tr></table></figure><p>这两行，这两行应该是主要逻辑。</p><p>首先，我们调用了<code>self.resolution</code>，我们进去看看：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107191616859-Q69Ns3.png!webp_90" alt="resolution" style="zoom:67%"><p>这里又调用了<code>resolutions</code>：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107191702182-edhbmZ.png!webp_90" alt="resolutions" style="zoom:67%"><p>这里我们发现又有一段新的逻辑，我们看下字段的注释：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107191746171-295pM4.png!webp_90" alt="module populate" style="zoom:67%"><p>会发现其实 module 的 resolution 是 lazy 计算的，ok，具体的<code>build_reduced_graph_external</code>想必就是计算的部分，我们在这里先跳过，作为一个黑盒，之后再去探究。</p><p>好了，现在回过头继续看刚才的代码：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107191616859-Q69Ns3.png!webp_90" alt="resolution" style="zoom:67%"><p>在<code>resolution</code>方法中，我们获取到了当前模块的所有<code>resolutions</code>，然后看看<code>key</code>是否存在，不存在就创建一个新的，并返回这个<code>resolution</code>。</p><p>再回到上层代码：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">resolution</span> = &amp;<span class="keyword">mut</span> *<span class="keyword">self</span>.<span class="title function_ invoke__">resolution</span>(module, key).<span class="title function_ invoke__">borrow_mut</span>();</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">t</span> = <span class="title function_ invoke__">f</span>(<span class="keyword">self</span>, resolution);</span><br></pre></td></tr></table></figure><p>这里我们拿到了<code>resolution</code>后调用了传入的 f，让我们回到<code>try_define</code>中，先看 else 部分：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.<span class="title function_ invoke__">update_resolution</span>(module, key, |this, resolution| &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(old_binding) = resolution.binding &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolution.binding = <span class="title function_ invoke__">Some</span>(binding);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这里如果返回的<code>resolution</code>的<code>binding</code>是<code>None</code>（对应上面<code>resolution</code>方法中新建的<code>resolution</code>，之前不存在），那么就把<code>resolution</code>的<code>binding</code>设为当前的<code>binding</code>然后返回<code>Ok</code>，逻辑还是比较简单的。</p><p>好了，让我们再接着看看如果原来已经有了一个<code>binding</code>，rustc 会如何处理：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">res</span> = binding.<span class="title function_ invoke__">res</span>();</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.<span class="title function_ invoke__">update_resolution</span>(module, key, |this, resolution| &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(old_binding) = resolution.binding &#123;</span><br><span class="line">        <span class="keyword">if</span> res == Res::<span class="literal">Err</span> &#123;</span><br><span class="line">            <span class="comment">// Do not override real bindings with `Res::Err`s from error recovery.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Ok</span>(());</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><p>这里如果之前返回的 res 本身就是 Err 的话，就直接返回，我们看一下 Err 的注释：</p> <img data-src="https://static.purewhite.io/uPic/2021-11-07/image-20211107192704528-TJIrs5.png!webp_90" alt="Res::Err" style="zoom:67%"><p>嗯，这部分直接无视吧，我们接着看：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">res</span> = binding.<span class="title function_ invoke__">res</span>();</span><br><span class="line"><span class="keyword">self</span>.<span class="title function_ invoke__">update_resolution</span>(module, key, |this, resolution| &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(old_binding) = resolution.binding &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">match</span> (old_binding.<span class="title function_ invoke__">is_glob_import</span>(), binding.<span class="title function_ invoke__">is_glob_import</span>()) &#123;</span><br><span class="line">            (<span class="literal">true</span>, <span class="literal">true</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> res != old_binding.<span class="title function_ invoke__">res</span>() &#123;</span><br><span class="line">                    resolution.binding = <span class="title function_ invoke__">Some</span>(this.<span class="title function_ invoke__">ambiguity</span>(</span><br><span class="line">                        AmbiguityKind::GlobVsGlob,</span><br><span class="line">                        old_binding,</span><br><span class="line">                        binding,</span><br><span class="line">                    ));</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> !old_binding.vis.<span class="title function_ invoke__">is_at_least</span>(binding.vis, &amp;*this) &#123;</span><br><span class="line">                    <span class="comment">// We are glob-importing the same item but with greater visibility.</span></span><br><span class="line">                    resolution.binding = <span class="title function_ invoke__">Some</span>(binding);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure><p>如果说新的和旧的都是<code>glob_import</code>，那么我们判断一下当前的<code>res</code>和之前的<code>res</code>是否是同一个，如果不是就说明出现了模糊性，我们把<code>resolution</code>的<code>binding</code>设置成<code>ambiguity</code>（模糊的意思）；如果两个<code>res</code>是同一个，那我们再判断一下可见性，如果说新的可见性更大，那我们就直接替换。</p><p>这里大家就会疑惑了，<code>glob_import</code>是啥？我们来插入一个小插曲：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">import_kind_to_string</span>(import_kind: &amp;ImportKind&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> import_kind &#123;</span><br><span class="line">        ImportKind::Single &#123; source, .. &#125; =&gt; source.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        ImportKind::Glob &#123; .. &#125; =&gt; <span class="string">&quot;*&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        ImportKind::ExternCrate &#123; .. &#125; =&gt; <span class="string">&quot;&lt;extern crate&gt;&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        ImportKind::MacroUse =&gt; <span class="string">&quot;#[macro_use]&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看到这大家应该都知道了吧，我就不过多解释了。</p><p>好的，回归正题，看起来这段是处理<code>use</code>相关的，我们可以简单略过，接着往下看：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">res</span> = binding.<span class="title function_ invoke__">res</span>();</span><br><span class="line"><span class="keyword">self</span>.<span class="title function_ invoke__">update_resolution</span>(module, key, |this, resolution| &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(old_binding) = resolution.binding &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">match</span> (old_binding.<span class="title function_ invoke__">is_glob_import</span>(), binding.<span class="title function_ invoke__">is_glob_import</span>()) &#123;</span><br><span class="line">            ...</span><br><span class="line">            (old_glob @ <span class="literal">true</span>, <span class="literal">false</span>) | (old_glob @ <span class="literal">false</span>, <span class="literal">true</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> (glob_binding, nonglob_binding) =</span><br><span class="line">                    <span class="keyword">if</span> old_glob &#123; (old_binding, binding) &#125; <span class="keyword">else</span> &#123; (binding, old_binding) &#125;;</span><br><span class="line">                <span class="keyword">if</span> glob_binding.<span class="title function_ invoke__">res</span>() != nonglob_binding.<span class="title function_ invoke__">res</span>()</span><br><span class="line">                    &amp;&amp; key.ns == MacroNS</span><br><span class="line">                    &amp;&amp; nonglob_binding.expansion != LocalExpnId::ROOT</span><br><span class="line">                &#123;</span><br><span class="line">                    resolution.binding = <span class="title function_ invoke__">Some</span>(this.<span class="title function_ invoke__">ambiguity</span>(</span><br><span class="line">                        AmbiguityKind::GlobVsExpanded,</span><br><span class="line">                        nonglob_binding,</span><br><span class="line">                        glob_binding,</span><br><span class="line">                    ));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resolution.binding = <span class="title function_ invoke__">Some</span>(nonglob_binding);</span><br><span class="line">                &#125;</span><br><span class="line">                resolution.shadowed_glob = <span class="title function_ invoke__">Some</span>(glob_binding);</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure><p>这一段我们处理了一个<code>glob_import</code>和一个非<code>glob_import</code>的情况，简单来说原则就是，非<code>glob</code>的优先，但是有个例外：如果非<code>glob</code>的是在宏中的，那么这里就会导致“模糊”（Rust 是卫生宏），这里会像上文一样把<code>binding</code>设为<code>ambiguity</code>。</p><p>这部分的逻辑涉及到宏的相关知识，我们先作为一个黑盒跳过，反正大概了解到了非<code>glob</code>优先，会<code>shadow</code>掉<code>glob</code>就完事，这也符合我们的编码经验和人体工程学。</p><p>好，我们最后看最简单的一部分：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">res</span> = binding.<span class="title function_ invoke__">res</span>();</span><br><span class="line"><span class="keyword">self</span>.<span class="title function_ invoke__">update_resolution</span>(module, key, |this, resolution| &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(old_binding) = resolution.binding &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">match</span> (old_binding.<span class="title function_ invoke__">is_glob_import</span>(), binding.<span class="title function_ invoke__">is_glob_import</span>()) &#123;</span><br><span class="line">            ...</span><br><span class="line">            (<span class="literal">false</span>, <span class="literal">false</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(old_binding);</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure><p>如果两个名字都不是<code>glob</code>引入的，那么就说明在当前的命名空间中我们出现了俩一样的名字（要注意在这里解析的不是变量名，所以不允许有一样的），那么就说明出错了，返回错误抛给上层，也就是我们的<code>define</code>方法中，并报错：</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Defines `name` in namespace `ns` of module `parent` to be `def` if it is not yet defined;</span></span><br><span class="line"><span class="comment">/// otherwise, reports an error.</span></span><br><span class="line"><span class="keyword">crate</span> <span class="keyword">fn</span> <span class="title function_">define</span>&lt;T&gt;(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, parent: Module&lt;<span class="symbol">&#x27;a</span>&gt;, ident: Ident, ns: Namespace, def: T)</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: ToNameBinding&lt;<span class="symbol">&#x27;a</span>&gt;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">binding</span> = def.<span class="title function_ invoke__">to_name_binding</span>(<span class="keyword">self</span>.arenas);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">key</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">new_key</span>(ident, ns);</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(old_binding) = <span class="keyword">self</span>.<span class="title function_ invoke__">try_define</span>(parent, key, binding) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">report_conflict</span>(parent, ident, ns, old_binding, &amp;binding);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>好了，至此，我们看完了我们开头所说的<code>the name xx is defined multiple times</code>相关的逻辑啦。</p><p>不过我们仍然遗留了一些问题，大家可以继续深入探究一下：</p><ol><li><code>binding</code>被标记为<code>ambiguity</code>后，会发生什么？</li><li><code>module</code>的<code>resolution</code>是怎么被解析出来的？也就是我们略过的<code>build_reduced_graph_external</code>干了啥？</li><li>宏展开导致的冲突为什么要特殊对待？</li></ol><p>大家可以顺着以上的问题继续探究，欢迎大家留言评论或者加入 Rust 中文社群一起讨论学习 Rust~</p></div><footer class="post-footer"><div class="reward-container"><div>请博主喝杯咖啡~</div> <button> 赞赏</button><div class="post-reward"><div> <img src="https://static.purewhite.io/wechat_pay.jpeg" alt="Pure White 微信"> <span>微信</span></div><div> <img src="https://static.purewhite.io/alipay.jpeg" alt="Pure White 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Pure White</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.purewhite.io/2021/11/07/rustc-resolve-reading-defined-multiple-times/" title="Rustc Reading Club：从一个错误出发学习 rustc_resolve">https://www.purewhite.io/2021/11/07/rustc-resolve-reading-defined-multiple-times/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"> <span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://static.purewhite.io/wechat_channel.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-tags"> <a href="/tags/rust/" rel="tag"># rust</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2021/09/23/rust-nomicon-translate/" rel="prev" title="The Rustonomicon 的中文翻译"><i class="fa fa-angle-left"></i> The Rustonomicon 的中文翻译</a></div><div class="post-nav-item"> <a href="/2022/03/16/bibipiano-recommend/" rel="next" title="给大家推荐一个 B 站宝藏 up 主 —— BiBiPiano">给大家推荐一个 B 站宝藏 up 主 —— BiBiPiano<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">沪ICP备15051443号-3</a> <img src="https://static.purewhite.io/images/2019-10-30-%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" alt=""><a href="https://beian.mps.gov.cn/#/query/webSearch?code=31010602004105" rel="noopener" target="_blank">沪公网安备 31010602004105号</a></div><div class="copyright"> &copy; 2017 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Pure White</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span title="站点总字数">92k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">5:34</span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/PureWhiteWu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/comments.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/motion.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/schemes/muse.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/next-boot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/bookmark.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.20.0/dist/algoliasearch-lite.umd.js" integrity="sha256-DABVk+hYj0mdUzo+7ViJC6cwLahQIejFvC+my2M/wfM=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.60.0/dist/instantsearch.production.min.js" integrity="sha256-9242vN47QUX50UG5Gf5XDO1YREWCEJRyXHofh5fsl24=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/search/algolia-search.min.js"></script><script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdn.jsdelivr.net/npm/wavedrom@3.3.0/wavedrom.min.js","integrity":"sha256-IRMDzTC+wK5stMucZ/XSXkeS5VNtxZ+/Bm8Mcqfoxdo="}}</script><script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdn.jsdelivr.net/npm/wavedrom@3.3.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/tags/wavedrom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/pace.min.js"></script><script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"DyCyUXRHZzXfXMk2Y2ysMPgL-gzGzoHsz","app_key":"7ULdnCBPkXxF6ArPc8VxaXy4","server_url":"https://leancloud.purewhite.io","security":true}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/statistics/lean-analytics.min.js"></script><script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"ignores":null,"url":"https://www.purewhite.io/2021/11/07/rustc-resolve-reading-defined-multiple-times/"}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/quicklink.min.js"></script><script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"blog-zr0zqnlt9p","count":true,"i18n":{"disqus":"disqus"}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.19.1/source/js/third-party/comments/disqus.min.js"></script></body></html>