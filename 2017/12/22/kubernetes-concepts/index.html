<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css"><meta name="google-site-verification" content="Xg_Hnp9ie-Rq7-zLPdd3c9dQtR_0N845ue4QaK8jvL4"><link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css"><link rel="stylesheet" href="https://use.fontawesome.com/11d7545abd.css"><link rel="stylesheet" href="/css/main.css?v=7.0.1"><link rel="apple-touch-icon" sizes="180x180" href="https://static.purewhite.io/favicon.jpg?v=7.0.1"><link rel="icon" type="image/png" sizes="32x32" href="https://static.purewhite.io/favicon.jpg?v=7.0.1"><link rel="icon" type="image/png" sizes="16x16" href="https://static.purewhite.io/favicon.jpg?v=7.0.1"><link rel="mask-icon" href="https://static.purewhite.io/favicon.jpg?v=7.0.1" color="#222"><meta property="fb:admins" content="100008177860594"><meta property="fb:app_id" content="761738893983932"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.0.1",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!0,fastclick:!0,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"ZP9482CZD3",apiKey:"d26207a3ce8de9fe98e7af4215425c93",indexName:"Blog",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="最近正在复习准备考试，于是一边复习一遍写成博客，印证自己所学。"><meta name="keywords" content="后端,架构,kubernetes"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes 架构 Overview"><meta property="og:url" content="https://purewhite.io/2017/12/22/kubernetes-concepts/index.html"><meta property="og:site_name" content="Pure White"><meta property="og:description" content="最近正在复习准备考试，于是一边复习一遍写成博客，印证自己所学。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://static.purewhite.io/images/2017-12-22-2FDF2789-F7EA-4EE6-8561-6FE7AD4A79D6.png"><meta property="og:image" content="https://static.purewhite.io/images/2017-12-22-D012D35E-5431-411E-AD4A-829A268E0875.png"><meta property="og:image" content="https://static.purewhite.io/images/2017-12-22-CA97E57F-D3C7-4BF0-BD0F-AB8E83838655.png"><meta property="og:updated_time" content="2019-03-18T06:14:05.383Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Kubernetes 架构 Overview"><meta name="twitter:description" content="最近正在复习准备考试，于是一边复习一遍写成博客，印证自己所学。"><meta name="twitter:image" content="https://static.purewhite.io/images/2017-12-22-2FDF2789-F7EA-4EE6-8561-6FE7AD4A79D6.png"><link rel="alternate" href="/atom.xml" title="Pure White" type="application/atom+xml"><link rel="canonical" href="https://purewhite.io/2017/12/22/kubernetes-concepts/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>Kubernetes 架构 Overview | Pure White</title><script>window.fbAsyncInit=function(){FB.init({appId:"761738893983932",xfbml:!0,version:"v2.10"})},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/zh_Hans/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk")</script><script async src="//www.googletagmanager.com/gtag/js?id=UA-98194081-1"></script><script>var host=window.location.hostname;if("localhost"!==host){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-98194081-1")}</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a29bb47eea3aa0d952f7bd979b29fa84";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Pure White</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">主业写bug，副业debug</h1></div><div class="site-nav-toggle"> <button aria-label="Toggle navigation bar"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-关于我"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="algolia-popup popup search-popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div></nav></div></header> <a href="https://github.com/PureWhiteWu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#222;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><div class="reading-progress-bar"></div><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://purewhite.io/2017/12/22/kubernetes-concepts/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Pure White"><meta itemprop="description" content="青春不是年华，是心境；<br />青春不是桃面、丹唇、柔膝，<br />而是深沉的意志、恢弘的想象、<br />炽热的感情。"><meta itemprop="image" content="https://static.purewhite.io/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Pure White"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Kubernetes 架构 Overview</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2017-12-22 13:51:13" itemprop="dateCreated datePublished" datetime="2017-12-22T13:51:13+08:00">2017-12-22</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-03-18 14:14:05" itemprop="dateModified" datetime="2019-03-18T14:14:05+08:00">2019-03-18</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/kubernetes/" itemprop="url" rel="index"><span itemprop="name">kubernetes</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Comments:</span><a href="/2017/12/22/kubernetes-concepts/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/22/kubernetes-concepts/" itemprop="commentCount"></span></a></span> <span id="/2017/12/22/kubernetes-concepts/" class="leancloud_visitors" data-flag-title="Kubernetes 架构 Overview"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">Views:</span><span class="leancloud-visitors-count"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span title="Symbols count in article">2.3k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span title="Reading time">2 mins.</span></div></div></header><div class="post-body han-init-context" itemprop="articleBody"><p>最近正在复习准备考试，于是一边复习一遍写成博客，印证自己所学。</p><a id="more"></a><h1 id="Kubernetes架构"><a href="#Kubernetes架构" class="headerlink" title="Kubernetes架构"></a>Kubernetes架构</h1><p>从高层看，kubernetes是由如下东西组成的：</p><ul><li>一个或多个master node</li><li>一个或多个worker node</li><li>一个分布式的key-value存储，比如<code>etcd</code></li></ul><p><img src="https://static.purewhite.io/images/2017-12-22-2FDF2789-F7EA-4EE6-8561-6FE7AD4A79D6.png" alt="2FDF2789-F7EA-4EE6-8561-6FE7AD4A79D6"></p><h1 id="Master-Node"><a href="#Master-Node" class="headerlink" title="Master Node"></a>Master Node</h1><p>Master node 是集群管理者，我们发出的所有请求都是到master node的api server上。</p><p>一个集群可以有多个master node做HA，当有多个master node的时候，只有一个会提供服务，剩下的都是follower。</p><p>集群的状态一般存储在<code>etcd</code>里面，所有的master node都会连接到etcd。etcd是一个分布式k-v存储。etcd可以是master内部的，也可以是外部的。</p><h3 id="Master-node的组件"><a href="#Master-node的组件" class="headerlink" title="Master node的组件"></a>Master node的组件</h3><p>master node一般都有如下组件：</p><h4 id="API-Server"><a href="#API-Server" class="headerlink" title="API Server"></a>API Server</h4><p>所有的操作都是通过 API Server 去完成的。每个用户/操作者通过发送REST请求到api server，然后api server先验证然后执行这些操作。在执行完之后把集群的状态存到etcd里面。</p><h4 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h4><p>顾名思义，Scheduler的作用是调度，Scheduler拥有所有worker node的资源使用情况，同时也知道用户设置的资源需求，比如说一个 <code>disk=ssd</code>的label。在调度之前，scheduler还会考虑到service requirements，data locality，affinity，anti-affinity等。scheduler负责的是service和pod的调度。</p><h4 id="Controller-Manager"><a href="#Controller-Manager" class="headerlink" title="Controller Manager"></a>Controller Manager</h4><p>简单来说，Controller Manager是负责启动和关闭pod的。Controller Manager的任务是让集群维持在期望的状态上。Controller Manager知道每个Pod的状态应该是什么样，然后会不断检测是否有不达标的pod。</p><h1 id="Worker-Node"><a href="#Worker-Node" class="headerlink" title="Worker Node"></a>Worker Node</h1><p>Worker Node就是一个被master node控制的机器，Pod一般都是调度到worker node里面的。Worker node会有一些可以运行以及连接容器的工具。Pod是kubernetes里面的调度单元，是一个或多个容器组成的通常一起调度的逻辑上的集合。</p><p><img src="https://static.purewhite.io/images/2017-12-22-D012D35E-5431-411E-AD4A-829A268E0875.png" alt="D012D35E-5431-411E-AD4A-829A268E0875"></p><h3 id="Worker-Node组件"><a href="#Worker-Node组件" class="headerlink" title="Worker Node组件"></a>Worker Node组件</h3><p>一个worker node一般会有以下组件：</p><h4 id="Contrainer-Runtime"><a href="#Contrainer-Runtime" class="headerlink" title="Contrainer Runtime"></a>Contrainer Runtime</h4><p>不用多说了，运行容器必备的，默认用的是Docker</p><h4 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h4><p>kubelet是在每个worker node上都会运行的，用来和master node通信的。kubelet从master接收pod的定义，然后启动里面的容器，并监控容器是否一直正常运行。</p><h4 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a>kube-proxy</h4><p>kube-proxy简单来说，就是对外提供代理服务的。换句话说，没有kube-proxy，我们要访问其中的application，就得直接访问到worker node上，这显然是不合理的。我们可以通过kube-proxy来做load balancer等。以前版本的Service也借助了kube-proxy。</p><h1 id="用etcd来管理状态"><a href="#用etcd来管理状态" class="headerlink" title="用etcd来管理状态"></a>用etcd来管理状态</h1><p>在kubernetes里面，都是用的etcd来管理所有的状态。除了集群的状态之外，还会用来存放一些信息，比如configmap，secret。</p><h1 id="网络需求"><a href="#网络需求" class="headerlink" title="网络需求"></a>网络需求</h1><p>为了启动一个全功能的kubernetes集群，我们需要先确认以下信息：</p><ul><li>每个Pod有唯一一个独立的IP</li><li>每个Pod里面的容器可以互相沟通</li><li>Pod之间可以互相沟通</li><li>通过设置，在Pod里面的application可以被外部访问到</li></ul><p>这些问题都是需要在部署之前被解决的。</p><p>我们一个个看：</p><h3 id="给每个Pod分配一个独立的IP"><a href="#给每个Pod分配一个独立的IP" class="headerlink" title="给每个Pod分配一个独立的IP"></a>给每个Pod分配一个独立的IP</h3><p>在kubernetes里面，每个Pod都要有一个独立的IP。一般容器网络有两种规格：</p><ul><li>Container Network Model (CNM)</li><li>Container Network Interface (CNI)</li></ul><p>Kubernetes用CNI来给Pod分配IP</p><p><img src="https://static.purewhite.io/images/2017-12-22-CA97E57F-D3C7-4BF0-BD0F-AB8E83838655.png" alt="CA97E57F-D3C7-4BF0-BD0F-AB8E83838655"></p><p>简单来说，容器运行时向CNI申请IP，然后CNI通过其下面指定的plugin来获取到IP，并且返回给容器运行时。</p><h3 id="容器之间交流"><a href="#容器之间交流" class="headerlink" title="容器之间交流"></a>容器之间交流</h3><p>一般基于底层操作系统的帮助，所有的容器运行时都会给每个容器创建一个独立的隔离的网络整体。在Linux上，这个整体被称为Network Namespace，这些Network Namespace可以在容器之间共享。</p><p>在一个Pod里面，容器共享Network Namespace，所以所有在同一个Pod里面的容器可以通过localhost来互相访问。</p><h3 id="跨Node的Pod之间访问"><a href="#跨Node的Pod之间访问" class="headerlink" title="跨Node的Pod之间访问"></a>跨Node的Pod之间访问</h3><p>在一个集群的环境下，每个Pod可以被调度到任何一个Node上，我们需要让在不同机器上的Pod也可以相互通信，并且任何Node都可以访问到任何Pod。Kubernetes设定了一个条件：不能有任何的NAT转换，我们可以通过以下方式来达成：</p><ul><li>可路由（Routable）的Pod和Node，通过底层的服务，比如GCE。</li><li>通过一些软件定义的网络（Software Defined Networking），比如flannel，weave，calico等</li></ul><p>更多的信息可以看看kubernetes的官方文档。</p><h3 id="外网和集群之间的访问"><a href="#外网和集群之间的访问" class="headerlink" title="外网和集群之间的访问"></a>外网和集群之间的访问</h3><p>我们可以通过<code>kube-proxy</code>来暴露我们的service，然后就能从外面访问到我们集群里面的应用了。</p></div><div><div id="reward-container"><div>请博主喝杯咖啡~</div> <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> Donate</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="https://static.purewhite.io/wechat_pay.jpeg" alt="Pure White WeChat Pay"><p>WeChat Pay</p></div><div style="display:inline-block"> <img src="https://static.purewhite.io/alipay.jpeg" alt="Pure White Alipay"><p>Alipay</p></div></div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/后端/" rel="tag"># 后端</a> <a href="/tags/架构/" rel="tag"># 架构</a> <a href="/tags/kubernetes/" rel="tag"># kubernetes</a> <a href="/tags/运维/" rel="tag"># 运维</a> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/linux/" rel="tag"># linux</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/12/21/design-pattern-opening-words/" rel="next" title="《Head First 设计模式》读书笔记0.5 —— 引子"><i class="fa fa-chevron-left"></i> 《Head First 设计模式》读书笔记0.5 —— 引子</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2017/12/22/install-kubernetes/" rel="prev" title="Kubernetes安装">Kubernetes安装<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> Overview</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://static.purewhite.io/avatar.jpg" alt="Pure White"><p class="site-author-name" itemprop="name">Pure White</p><div class="site-description motion-element" itemprop="description">青春不是年华，是心境；<br>青春不是桃面、丹唇、柔膝，<br>而是深沉的意志、恢弘的想象、<br>炽热的感情。</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">45</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/PureWhiteWu" title="GitHub &rarr; https://github.com/PureWhiteWu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:daniel48@126.com" title="E-Mail &rarr; mailto:daniel48@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://twitter.com/PureWhite_Wu" title="Twitter &rarr; https://twitter.com/PureWhite_Wu" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span><span class="links-of-author-item"><a href="https://www.linkedin.com/in/%E8%BF%AA-%E5%90%B4-846051106/" title="LinkedIn &rarr; https://www.linkedin.com/in/%E8%BF%AA-%E5%90%B4-846051106/" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a></span><span class="links-of-author-item"><a href="https://telegram.me/PureWhiteWu" title="Telegram &rarr; https://telegram.me/PureWhiteWu" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i> Telegram</a></span><span class="links-of-author-item"><a href="http://weibo.com/purewhitewu" title="微博 &rarr; http://weibo.com/purewhitewu" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> 微博</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/PureWhite_Wu" title="知乎 &rarr; https://www.zhihu.com/people/PureWhite_Wu" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://static.purewhite.io/wechat.jpeg" title="微信 &rarr; https://static.purewhite.io/wechat.jpeg" rel="noopener" target="_blank"><i class="fa fa-fw fa-weixin"></i> 微信</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://blog.didispace.com/" title="http://blog.didispace.com/" rel="noopener" target="_blank">程序猿DD</a></li><li class="links-of-blogroll-item"> <a href="http://leoif.me/" title="http://leoif.me/" rel="noopener" target="_blank">leoif</a></li><li class="links-of-blogroll-item"> <a href="http://www.v2ex.com/?r=PureWhiteWu" title="http://www.v2ex.com/?r=PureWhiteWu" rel="noopener" target="_blank">v2ex</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Kubernetes架构"><span class="nav-number">1.</span> <span class="nav-text">Kubernetes架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Master-Node"><span class="nav-number">2.</span> <span class="nav-text">Master Node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Master-node的组件"><span class="nav-number">2.0.1.</span> <span class="nav-text">Master node的组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#API-Server"><span class="nav-number">2.0.1.1.</span> <span class="nav-text">API Server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scheduler"><span class="nav-number">2.0.1.2.</span> <span class="nav-text">Scheduler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Controller-Manager"><span class="nav-number">2.0.1.3.</span> <span class="nav-text">Controller Manager</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#Worker-Node"><span class="nav-number">3.</span> <span class="nav-text">Worker Node</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Worker-Node组件"><span class="nav-number">3.0.1.</span> <span class="nav-text">Worker Node组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Contrainer-Runtime"><span class="nav-number">3.0.1.1.</span> <span class="nav-text">Contrainer Runtime</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#kubelet"><span class="nav-number">3.0.1.2.</span> <span class="nav-text">kubelet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#kube-proxy"><span class="nav-number">3.0.1.3.</span> <span class="nav-text">kube-proxy</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用etcd来管理状态"><span class="nav-number">4.</span> <span class="nav-text">用etcd来管理状态</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络需求"><span class="nav-number">5.</span> <span class="nav-text">网络需求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#给每个Pod分配一个独立的IP"><span class="nav-number">5.0.1.</span> <span class="nav-text">给每个Pod分配一个独立的IP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器之间交流"><span class="nav-number">5.0.2.</span> <span class="nav-text">容器之间交流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跨Node的Pod之间访问"><span class="nav-number">5.0.3.</span> <span class="nav-text">跨Node的Pod之间访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外网和集群之间的访问"><span class="nav-number">5.0.4.</span> <span class="nav-text">外网和集群之间的访问</span></a></li></ol></li></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> <a href="http://www.miitbeian.gov.cn" rel="noopener" target="_blank">沪ICP备15051443号-3</a> &copy; 2017 – <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Pure White</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Symbols count total:</span> <span title="Symbols count total">120k</span></div><div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.1</div><script>!function(){var e=document.createElement("script");e.src="//tajs.qq.com/stats?sId=61888292";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script><script src="/lib/reading_progress/reading_progress.js"></script><script src="/js/src/utils.js?v=7.0.1"></script><script src="/js/src/motion.js?v=7.0.1"></script><script src="/js/src/schemes/muse.js?v=7.0.1"></script><script src="/js/src/scrollspy.js?v=7.0.1"></script><script src="/js/src/post-details.js?v=7.0.1"></script><script src="/js/src/next-boot.js?v=7.0.1"></script><script src="/js/src/js.cookie.js?v=7.0.1"></script><script src="/js/src/scroll-cookie.js?v=7.0.1"></script><script id="dsq-count-scr" src="https://blog-zr0zqnlt9p.disqus.com/count.js" async></script><script>var disqus_config=function(){this.page.url="https://purewhite.io/2017/12/22/kubernetes-concepts/",this.page.identifier="2017/12/22/kubernetes-concepts/",this.page.title="Kubernetes 架构 Overview"};function loadComments(){var e=document,t=e.createElement("script");t.src="https://blog-zr0zqnlt9p.disqus.com/embed.js",t.setAttribute("data-timestamp",""+ +new Date),(e.head||e.body).appendChild(t)}$(function(){$("#comments").offset().top-$(window).height()<=0?loadComments():$(window).on("scroll.disqus_scroll",function(){$("#comments").offset().top-$(window).height()-$(window).scrollTop()<60&&($(window).off(".disqus_scroll"),loadComments())})})</script><link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css"><script src="/lib/algolia-instant-search/instantsearch.min.js"></script><script src="/js/src/algolia-search.js?v=7.0.1"></script><script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.time + 1);
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
              })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1 }))
                .done(function() {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function() {
                  console.log('Failed to create');
                });
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'Sa9GIjpR90eFliBWzUAiUp9W-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'Sa9GIjpR90eFliBWzUAiUp9W-gzGzoHsz',
                'X-LC-Key': 'rSpeP2HoYIdOYJr4p2elMvLn',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>wpac_init=window.wpac_init||[],wpac_init.push({widget:"Rating",id:8500,el:"wpac-rating",color:"fc6423"}),function(){if(!("WIDGETPACK_LOADED"in window)){WIDGETPACK_LOADED=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t.nextSibling)}}()</script><script src="/lib/pangu/dist/pangu.min.js?v=3.3"></script><script>pangu.spacingPage()</script><script src="/lib/bookmark/bookmark.min.js?v=1.0"></script><script>bookmark.scrollToMark("auto","#more")</script><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("Copy").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=window.pageYOffset||document.documentElement.scrollTop;n.style.top=o+"px",n.style.position="absolute",n.style.opacity="0",n.readOnly=!0,n.value=t,document.body.appendChild(n),n.select(),n.setSelectionRange(0,t.length),n.readOnly=!1,document.execCommand("copy")?$(this).text("Copied"):$(this).text("Copy failed"),n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("Copy")},300)}).append(t)})</script></body></html>