<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3/dist/han.min.css"><meta name="google-site-verification" content="Xg_Hnp9ie-Rq7-zLPdd3c9dQtR_0N845ue4QaK8jvL4"><link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css"><link rel="stylesheet" href="https://use.fontawesome.com/11d7545abd.css"><link rel="stylesheet" href="/css/main.css?v=7.0.1"><link rel="apple-touch-icon" sizes="180x180" href="https://static.purewhite.io/favicon.jpg?v=7.0.1"><link rel="icon" type="image/png" sizes="32x32" href="https://static.purewhite.io/favicon.jpg?v=7.0.1"><link rel="icon" type="image/png" sizes="16x16" href="https://static.purewhite.io/favicon.jpg?v=7.0.1"><link rel="mask-icon" href="https://static.purewhite.io/favicon.jpg?v=7.0.1" color="#222"><meta property="fb:admins" content="100008177860594"><meta property="fb:app_id" content="761738893983932"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.0.1",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!0,fastclick:!0,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"ZP9482CZD3",apiKey:"d26207a3ce8de9fe98e7af4215425c93",indexName:"Blog",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="为什么要有这俩玩意儿？我们在kubernetes上部署应用的时候，经常会需要传一些配置给我们的应用，比如数据库地址啊，用户名密码啊之类的。我们要做到这个，有好多种方案，比如：  我们可以直接在打包镜像的时候写在应用配置文件里面，但是这种方式的坏处显而易见而且非常明显。 我们可以在配置文件里面通过env环境变量传入，但是这样的话我们要修改env就必须去修改yaml文件，而且需要重启所有的contai"><meta name="keywords" content="后端,架构,kubernetes"><meta property="og:type" content="article"><meta property="og:title" content="kubernetes 中的 ConfigMap 和 Secret"><meta property="og:url" content="https://purewhite.io/2017/12/28/kubernetes-configmap-and-secret/index.html"><meta property="og:site_name" content="Pure White"><meta property="og:description" content="为什么要有这俩玩意儿？我们在kubernetes上部署应用的时候，经常会需要传一些配置给我们的应用，比如数据库地址啊，用户名密码啊之类的。我们要做到这个，有好多种方案，比如：  我们可以直接在打包镜像的时候写在应用配置文件里面，但是这种方式的坏处显而易见而且非常明显。 我们可以在配置文件里面通过env环境变量传入，但是这样的话我们要修改env就必须去修改yaml文件，而且需要重启所有的contai"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-03-18T06:14:05.497Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="kubernetes 中的 ConfigMap 和 Secret"><meta name="twitter:description" content="为什么要有这俩玩意儿？我们在kubernetes上部署应用的时候，经常会需要传一些配置给我们的应用，比如数据库地址啊，用户名密码啊之类的。我们要做到这个，有好多种方案，比如：  我们可以直接在打包镜像的时候写在应用配置文件里面，但是这种方式的坏处显而易见而且非常明显。 我们可以在配置文件里面通过env环境变量传入，但是这样的话我们要修改env就必须去修改yaml文件，而且需要重启所有的contai"><link rel="alternate" href="/atom.xml" title="Pure White" type="application/atom+xml"><link rel="canonical" href="https://purewhite.io/2017/12/28/kubernetes-configmap-and-secret/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>kubernetes 中的 ConfigMap 和 Secret | Pure White</title><script>window.fbAsyncInit=function(){FB.init({appId:"761738893983932",xfbml:!0,version:"v2.10"})},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/zh_Hans/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk")</script><script async src="//www.googletagmanager.com/gtag/js?id=UA-98194081-1"></script><script>var host=window.location.hostname;if("localhost"!==host){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-98194081-1")}</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a29bb47eea3aa0d952f7bd979b29fa84";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Pure White</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">主业写bug，副业debug</h1></div><div class="site-nav-toggle"> <button aria-label="Toggle navigation bar"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-关于我"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="algolia-popup popup search-popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div></nav></div></header> <a href="https://github.com/PureWhiteWu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#222;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><div class="reading-progress-bar"></div><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://purewhite.io/2017/12/28/kubernetes-configmap-and-secret/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Pure White"><meta itemprop="description" content="青春不是年华，是心境；<br />青春不是桃面、丹唇、柔膝，<br />而是深沉的意志、恢弘的想象、<br />炽热的感情。"><meta itemprop="image" content="https://static.purewhite.io/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Pure White"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">kubernetes 中的 ConfigMap 和 Secret</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2017-12-28 15:50:20" itemprop="dateCreated datePublished" datetime="2017-12-28T15:50:20+08:00">2017-12-28</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-03-18 14:14:05" itemprop="dateModified" datetime="2019-03-18T14:14:05+08:00">2019-03-18</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/kubernetes/" itemprop="url" rel="index"><span itemprop="name">kubernetes</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Comments:</span><a href="/2017/12/28/kubernetes-configmap-and-secret/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/28/kubernetes-configmap-and-secret/" itemprop="commentCount"></span></a></span> <span id="/2017/12/28/kubernetes-configmap-and-secret/" class="leancloud_visitors" data-flag-title="kubernetes 中的 ConfigMap 和 Secret"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">Views:</span><span class="leancloud-visitors-count"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span title="Symbols count in article">4.5k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span title="Reading time">4 mins.</span></div></div></header><div class="post-body han-init-context" itemprop="articleBody"><h1 id="为什么要有这俩玩意儿？"><a href="#为什么要有这俩玩意儿？" class="headerlink" title="为什么要有这俩玩意儿？"></a>为什么要有这俩玩意儿？</h1><p>我们在kubernetes上部署应用的时候，经常会需要传一些配置给我们的应用，比如数据库地址啊，用户名密码啊之类的。我们要做到这个，有好多种方案，比如：</p><ul><li>我们可以直接在打包镜像的时候写在应用配置文件里面，但是这种方式的坏处显而易见而且非常明显。</li><li>我们可以在配置文件里面通过env环境变量传入，但是这样的话我们要修改env就必须去修改yaml文件，而且需要重启所有的container才行。</li><li>我们可以在应用启动的时候去数据库或者某个特定的地方拿，没问题！但是第一，实现起来麻烦；第二，如果配置的地方变了怎么办？</li></ul><p>当然还有别的方案，但是各种方案都有各自的问题。</p><p>而且，还有一个问题就是，如果说我的一个配置，是要多个应用一起使用的，以上除了第三种方案，都没办法进行配置的共享，就是说我如果要改配置的话，那得一个一个手动改。假如我们有100个应用，就得改100份配置，以此类推……</p><p>kubernetes对这个问题提供了一个很好的解决方案，就是用<strong>ConfigMap</strong>和<strong>Secret</strong>。</p><a id="more"></a><h1 id="创建ConfigMap"><a href="#创建ConfigMap" class="headerlink" title="创建ConfigMap"></a>创建ConfigMap</h1><p>ConfigMap让我们能够从容器镜像中把配置的详细信息给解耦出来。通过ConfigMap我们能够把配置以key-value对的形式传递到container或者别的系统组件（比如Controller）里面。我们可以通过两种方式来创建ConfigMap：</p><h2 id="From-Literal-Values"><a href="#From-Literal-Values" class="headerlink" title="From Literal Values"></a>From Literal Values</h2><p>我们可以用<code>kubectl create</code>来创建一个ConfigMap，然后通过<code>kubectl get</code>来获取：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create the ConfigMap</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl create configmap my-config --from-literal=key1=value1 --from-literal=key2=value2</span></span><br><span class="line">configmap "my-config" created </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Get the ConfigMap Details <span class="keyword">for</span> my-config</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl get configmaps my-config -o yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  key1: value1</span><br><span class="line">  key2: value2</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: 2017-05-31T07:21:55Z</span><br><span class="line">  name: my-config</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: "241345"</span><br><span class="line">  selfLink: /api/v1/namespaces/default/configmaps/my-config</span><br><span class="line">  uid: d35f0a3d-45d1-11e7-9e62-080027a46057</span><br></pre></td></tr></table></figure><p><code>-o yaml</code>的作用是通过yaml的形式来返回我们所要求的配置信息。</p><h2 id="From-Configuration-File"><a href="#From-Configuration-File" class="headerlink" title="From Configuration File"></a>From Configuration File</h2><p>除了上面的方式，我们还可以直接通过配置文件来创建（好吧，虽然我感觉是同一种，只不过是放到文件里面了而已……），首先，我们得有一个配置文件，假设名字叫做<code>myconfigmap.yaml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">customer1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line"><span class="attr">  TEXT1:</span> <span class="string">Customer1_Company</span></span><br><span class="line"><span class="attr">  TEXT2:</span> <span class="string">Welcomes</span> <span class="string">You</span></span><br><span class="line"><span class="attr">  COMPANY:</span> <span class="string">Customer1</span> <span class="string">Company</span> <span class="string">Technology</span> <span class="string">Pct.</span> <span class="string">Ltd.</span></span><br></pre></td></tr></table></figure><p>然后，我们可以通过<code>kubectl create -f</code>来创建：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl create -f myconfigmap.yaml</span></span><br><span class="line">configmap "customer1" created</span><br></pre></td></tr></table></figure><h1 id="使用ConfigMap"><a href="#使用ConfigMap" class="headerlink" title="使用ConfigMap"></a>使用ConfigMap</h1><p>我们可以有两种方法来使用ConfigMap：</p><h2 id="通过env"><a href="#通过env" class="headerlink" title="通过env"></a>通过env</h2><p>我们可以设置env从ConfigMap读取：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">....</span></span><br><span class="line"><span class="attr"> containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">rsvp-app</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">teamcloudyuga/rsvpapp</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">MONGODB_HOST</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">TEXT1</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            configMapKeyRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">customer1</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">TEXT1</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">TEXT2</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            configMapKeyRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">customer1</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">TEXT2</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">COMPANY</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            configMapKeyRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">customer1</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">COMPANY</span></span><br><span class="line"></span><br><span class="line"><span class="string">....</span></span><br></pre></td></tr></table></figure><p>这样，我们的container就可以读取到ConfigMap里面存储的信息了。</p><p>不过一般情况下，我个人推荐使用另一种方式：</p><h2 id="通过Volume"><a href="#通过Volume" class="headerlink" title="通过Volume"></a>通过Volume</h2><p>这种方式我比较推荐，因为随着ConfigMap被修改（比如你想要更新一些设置），container里面对应的文件内容也会被修改，这样可以不用重启Container就让应用能够得到最新的配置信息。</p><p>这个内容需要一些Volume相关的知识，在此不做更多讲解，大家可以去参考<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#adding-configmap-data-to-a-volume" target="_blank" rel="noopener">官方文档</a>。</p><h1 id="创建Secret"><a href="#创建Secret" class="headerlink" title="创建Secret"></a>创建Secret</h1><p>通过上面的部分，我们可以看到ConfigMap是用来做一些配置信息的，那么如果我们有一些机密信息比如说密钥、密码之类的信息，应该存在哪里呢？看到这个名字大家应该就明白了吧，kubernetes提供了Secret来存储相关的信息。</p><p>具体为什么要存在Secret里面，Secret和ConfigMap有什么区别，后面会讲到。</p><h2 id="创建Secret-1"><a href="#创建Secret-1" class="headerlink" title="创建Secret"></a>创建Secret</h2><p>我们可以通过<code>kubectl create secret</code>来通过一个文件创建一个secret，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create a file with password</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">'mysqlpassword'</span> &gt; password.txt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make sure there is no trailing newline <span class="keyword">in</span> the file, after our password. </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To remove any newline, we can use the tr <span class="built_in">command</span>:</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tr -Ccsu <span class="string">'\n'</span> &lt; password.txt &gt; .strippedpassword.txt &amp;&amp; mv .strippedpassword.txt password.txt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create the Secret </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl create secret generic my-password --from-file=password.txt</span></span><br><span class="line">secret "my-password" created</span><br></pre></td></tr></table></figure><p>我们也可以手动创建一个Secret，不过要注意，所有的secret的data都要以base64进行加密：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat password.txt | base64</span></span><br><span class="line">bXlzcWxwYXN3b3JkCg==</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> and <span class="keyword">then</span> use it <span class="keyword">in</span> the configuration file:</span></span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: my-password</span><br><span class="line">type: Opaque</span><br><span class="line">data:</span><br><span class="line">  password: bXlzcWxwYXN3b3JkCg==</span><br></pre></td></tr></table></figure><h1 id="使用Secret"><a href="#使用Secret" class="headerlink" title="使用Secret"></a>使用Secret</h1><h2 id="获取Secret"><a href="#获取Secret" class="headerlink" title="获取Secret"></a>获取Secret</h2><p>我们可以通过<code>get</code>和<code>describe</code>来获取Secret，不过我们发现，<code>kubectl</code>并没有向我们返回Secret具体的内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get secret my-password</span></span><br><span class="line">NAME          TYPE     DATA   AGE </span><br><span class="line">my-password   Opaque   1      8m</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl describe secret my-password</span></span><br><span class="line">Name:          my-password</span><br><span class="line">Namespace:     default</span><br><span class="line">Labels:        &lt;none&gt;</span><br><span class="line">Annotations:   &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Type  Opaque</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">password.txt:  13 bytes</span><br></pre></td></tr></table></figure><h2 id="在Pod里面使用"><a href="#在Pod里面使用" class="headerlink" title="在Pod里面使用"></a>在Pod里面使用</h2><p>和ConfigMap一样，我们可以通过设置成env或者挂载成volume来使容器可以使用我们的secret。</p><p>具体格式如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.....</span></span><br><span class="line"><span class="attr">         spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - image:</span> <span class="attr">wordpress:4.7.3-apache</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">WORDPRESS_DB_HOST</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">wordpress-mysql</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">WORDPRESS_DB_PASSWORD</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            secretKeyRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">my-password</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">password.txt</span></span><br><span class="line"><span class="string">.....</span></span><br></pre></td></tr></table></figure><p>关于如何在Volume中使用的还是需要自行查询文档学习。</p><h1 id="扯淡的Secret"><a href="#扯淡的Secret" class="headerlink" title="扯淡的Secret"></a>扯淡的Secret</h1><p>好了，总算正文部分完了，可以讲讲Secret和ConfigMap的关系了，以及讲讲Secret到底有多扯淡……</p><p>其实目前Secret的实现，就是ConfigMap把value用base64 encode了一下……</p><p>所以，其实不存在任何安全性……</p><p>只要decode一下就能出现原来结果，相当于明文存储……</p><p>base64这玩意儿都不能叫做加密，只能叫做编码……</p><p>所以我们都不说encrypt，而是encode和decode……</p><p>当然，k8s社区有在计划对Secret进行下一步的安全性增强，当然这是后话了……</p><p>反正目前为止，Secret基本和ConfigMap一样是明文存储……</p><p>知道有多扯淡了吧……</p></div><div><div id="reward-container"><div>请博主喝杯咖啡~</div> <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> Donate</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="https://static.purewhite.io/wechat_pay.jpeg" alt="Pure White WeChat Pay"><p>WeChat Pay</p></div><div style="display:inline-block"> <img src="https://static.purewhite.io/alipay.jpeg" alt="Pure White Alipay"><p>Alipay</p></div></div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/kubernetes/" rel="tag"># kubernetes</a> <a href="/tags/运维/" rel="tag"># 运维</a> <a href="/tags/后端/" rel="tag"># 后端</a> <a href="/tags/架构/" rel="tag"># 架构</a> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/linux/" rel="tag"># linux</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/12/25/kubernetes-volumes/" rel="next" title="kubernetes中的Volume"><i class="fa fa-chevron-left"></i> kubernetes中的Volume</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2017/12/28/kubernetes-ingress/" rel="prev" title="kubernetes 中的 ingress">kubernetes 中的 ingress<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> Overview</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://static.purewhite.io/avatar.jpg" alt="Pure White"><p class="site-author-name" itemprop="name">Pure White</p><div class="site-description motion-element" itemprop="description">青春不是年华，是心境；<br>青春不是桃面、丹唇、柔膝，<br>而是深沉的意志、恢弘的想象、<br>炽热的感情。</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">47</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/PureWhiteWu" title="GitHub &rarr; https://github.com/PureWhiteWu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:daniel48@126.com" title="E-Mail &rarr; mailto:daniel48@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://twitter.com/PureWhite_Wu" title="Twitter &rarr; https://twitter.com/PureWhite_Wu" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span><span class="links-of-author-item"><a href="https://www.linkedin.com/in/%E8%BF%AA-%E5%90%B4-846051106/" title="LinkedIn &rarr; https://www.linkedin.com/in/%E8%BF%AA-%E5%90%B4-846051106/" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a></span><span class="links-of-author-item"><a href="https://telegram.me/PureWhiteWu" title="Telegram &rarr; https://telegram.me/PureWhiteWu" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i> Telegram</a></span><span class="links-of-author-item"><a href="http://weibo.com/purewhitewu" title="微博 &rarr; http://weibo.com/purewhitewu" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> 微博</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/PureWhite_Wu" title="知乎 &rarr; https://www.zhihu.com/people/PureWhite_Wu" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://static.purewhite.io/wechat.jpeg" title="微信 &rarr; https://static.purewhite.io/wechat.jpeg" rel="noopener" target="_blank"><i class="fa fa-fw fa-weixin"></i> 微信</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://blog.didispace.com/" title="http://blog.didispace.com/" rel="noopener" target="_blank">程序猿DD</a></li><li class="links-of-blogroll-item"> <a href="http://leoif.me/" title="http://leoif.me/" rel="noopener" target="_blank">leoif</a></li><li class="links-of-blogroll-item"> <a href="http://www.v2ex.com/?r=PureWhiteWu" title="http://www.v2ex.com/?r=PureWhiteWu" rel="noopener" target="_blank">v2ex</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#为什么要有这俩玩意儿？"><span class="nav-number">1.</span> <span class="nav-text">为什么要有这俩玩意儿？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建ConfigMap"><span class="nav-number">2.</span> <span class="nav-text">创建ConfigMap</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#From-Literal-Values"><span class="nav-number">2.1.</span> <span class="nav-text">From Literal Values</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#From-Configuration-File"><span class="nav-number">2.2.</span> <span class="nav-text">From Configuration File</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用ConfigMap"><span class="nav-number">3.</span> <span class="nav-text">使用ConfigMap</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#通过env"><span class="nav-number">3.1.</span> <span class="nav-text">通过env</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过Volume"><span class="nav-number">3.2.</span> <span class="nav-text">通过Volume</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建Secret"><span class="nav-number">4.</span> <span class="nav-text">创建Secret</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建Secret-1"><span class="nav-number">4.1.</span> <span class="nav-text">创建Secret</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Secret"><span class="nav-number">5.</span> <span class="nav-text">使用Secret</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#获取Secret"><span class="nav-number">5.1.</span> <span class="nav-text">获取Secret</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在Pod里面使用"><span class="nav-number">5.2.</span> <span class="nav-text">在Pod里面使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#扯淡的Secret"><span class="nav-number">6.</span> <span class="nav-text">扯淡的Secret</span></a></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> <a href="http://www.miitbeian.gov.cn" rel="noopener" target="_blank">沪ICP备15051443号-3</a> &copy; 2017 – <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Pure White</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Symbols count total:</span> <span title="Symbols count total">134k</span></div><div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.1</div><script>!function(){var e=document.createElement("script");e.src="//tajs.qq.com/stats?sId=61888292";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script><script src="/lib/reading_progress/reading_progress.js"></script><script src="/js/src/utils.js?v=7.0.1"></script><script src="/js/src/motion.js?v=7.0.1"></script><script src="/js/src/schemes/muse.js?v=7.0.1"></script><script src="/js/src/scrollspy.js?v=7.0.1"></script><script src="/js/src/post-details.js?v=7.0.1"></script><script src="/js/src/next-boot.js?v=7.0.1"></script><script src="/js/src/js.cookie.js?v=7.0.1"></script><script src="/js/src/scroll-cookie.js?v=7.0.1"></script><script id="dsq-count-scr" src="https://blog-zr0zqnlt9p.disqus.com/count.js" async></script><script>var disqus_config=function(){this.page.url="https://purewhite.io/2017/12/28/kubernetes-configmap-and-secret/",this.page.identifier="2017/12/28/kubernetes-configmap-and-secret/",this.page.title="kubernetes 中的 ConfigMap 和 Secret"};function loadComments(){var e=document,t=e.createElement("script");t.src="https://blog-zr0zqnlt9p.disqus.com/embed.js",t.setAttribute("data-timestamp",""+ +new Date),(e.head||e.body).appendChild(t)}$(function(){$("#comments").offset().top-$(window).height()<=0?loadComments():$(window).on("scroll.disqus_scroll",function(){$("#comments").offset().top-$(window).height()-$(window).scrollTop()<60&&($(window).off(".disqus_scroll"),loadComments())})})</script><link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css"><script src="/lib/algolia-instant-search/instantsearch.min.js"></script><script src="/js/src/algolia-search.js?v=7.0.1"></script><script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.time + 1);
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
              })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1 }))
                .done(function() {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function() {
                  console.log('Failed to create');
                });
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'Sa9GIjpR90eFliBWzUAiUp9W-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'Sa9GIjpR90eFliBWzUAiUp9W-gzGzoHsz',
                'X-LC-Key': 'rSpeP2HoYIdOYJr4p2elMvLn',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>wpac_init=window.wpac_init||[],wpac_init.push({widget:"Rating",id:8500,el:"wpac-rating",color:"fc6423"}),function(){if(!("WIDGETPACK_LOADED"in window)){WIDGETPACK_LOADED=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t.nextSibling)}}()</script><script src="/lib/pangu/dist/pangu.min.js?v=3.3"></script><script>pangu.spacingPage()</script><script src="/lib/bookmark/bookmark.min.js?v=1.0"></script><script>bookmark.scrollToMark("auto","#more")</script><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("Copy").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=window.pageYOffset||document.documentElement.scrollTop;n.style.top=o+"px",n.style.position="absolute",n.style.opacity="0",n.readOnly=!0,n.value=t,document.body.appendChild(n),n.select(),n.setSelectionRange(0,t.length),n.readOnly=!1,document.execCommand("copy")?$(this).text("Copied"):$(this).text("Copy failed"),n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("Copy")},300)}).append(t)})</script></body></html>