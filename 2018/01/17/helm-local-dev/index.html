<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="apple-touch-icon" sizes="180x180" href="https://static.purewhite.io/favicon.jpg?v=7.3.0"><link rel="icon" type="image/png" sizes="32x32" href="https://static.purewhite.io/favicon.jpg?v=7.3.0"><link rel="icon" type="image/png" sizes="16x16" href="https://static.purewhite.io/favicon.jpg?v=7.3.0"><link rel="mask-icon" href="https://static.purewhite.io/favicon.jpg?v=7.3.0" color="#222"><meta name="google-site-verification" content="Xg_Hnp9ie-Rq7-zLPdd3c9dQtR_0N845ue4QaK8jvL4"><meta property="fb:admins" content="100008177860594"><meta property="fb:app_id" content="761738893983932"><link rel="stylesheet" href="/css/main.css?v=7.3.0"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.3.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!0,algolia:{appID:"ZP9482CZD3",apiKey:"d26207a3ce8de9fe98e7af4215425c93",indexName:"Blog",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"Copy",copy_success:"Copied",copy_failure:"Copy failed"}}</script><meta name="description" content="Helm是kubernetes的官方包管理工具。根据官网上的描述Helm is the best way to find, share, and use software built for Kubernetes.可以看出helm在kubernetes社区中的定位。 这篇文章并不是helm的入门文章，而是着重于如何在本地开发chart。希望进行helm入门的同学可以参考官方文档。"><meta name="keywords" content="后端,架构,kubernetes,helm"><meta property="og:type" content="article"><meta property="og:title" content="如何使用Helm进行本地开发"><meta property="og:url" content="https://purewhite.io/2018/01/17/helm-local-dev/index.html"><meta property="og:site_name" content="Pure White"><meta property="og:description" content="Helm是kubernetes的官方包管理工具。根据官网上的描述Helm is the best way to find, share, and use software built for Kubernetes.可以看出helm在kubernetes社区中的定位。 这篇文章并不是helm的入门文章，而是着重于如何在本地开发chart。希望进行helm入门的同学可以参考官方文档。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-03-18T06:14:04.391Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="如何使用Helm进行本地开发"><meta name="twitter:description" content="Helm是kubernetes的官方包管理工具。根据官网上的描述Helm is the best way to find, share, and use software built for Kubernetes.可以看出helm在kubernetes社区中的定位。 这篇文章并不是helm的入门文章，而是着重于如何在本地开发chart。希望进行helm入门的同学可以参考官方文档。"><link rel="alternate" href="/atom.xml" title="Pure White" type="application/atom+xml"><link rel="canonical" href="https://purewhite.io/2018/01/17/helm-local-dev/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>如何使用Helm进行本地开发 | Pure White</title><meta name="generator" content="Hexo 3.9.0"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-98194081-1"></script><script pjax>var host=window.location.hostname;if("localhost"!==host){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-98194081-1")}</script><script pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a29bb47eea3aa0d952f7bd979b29fa84";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container use-motion"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Pure White</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">主业写bug，副业debug</h1></div><div class="site-nav-toggle"> <button aria-label="Toggle navigation bar"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-关于我"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a class="book-mark-link book-mark-link-fixed" href="#"></a> <a href="https://github.com/PureWhiteWu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article itemscope itemtype="http://schema.org/Article"><div class="post-block post"><link itemprop="mainEntityOfPage" href="https://purewhite.io/2018/01/17/helm-local-dev/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Pure White"><meta itemprop="description" content="青春不是年华，是心境；<br />青春不是桃面、丹唇、柔膝，<br />而是深沉的意志、恢弘的想象、<br />炽热的感情。"><meta itemprop="image" content="https://static.purewhite.io/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Pure White"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">如何使用Helm进行本地开发</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2018-01-17 12:49:30" itemprop="dateCreated datePublished" datetime="2018-01-17T12:49:30+08:00">2018-01-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-03-18 14:14:04" itemprop="dateModified" datetime="2019-03-18T14:14:04+08:00">2019-03-18</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/kubernetes/" itemprop="url" rel="index"><span itemprop="name">kubernetes</span></a></span></span><span id="/2018/01/17/helm-local-dev/" class="post-meta-item leancloud_visitors" data-flag-title="如何使用Helm进行本地开发" title="Views"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">Views:</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Disqus:</span><a title="disqus" href="/2018/01/17/helm-local-dev/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/17/helm-local-dev/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span>14k</span></span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span>12 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p><a href="https://helm.sh/" target="_blank" rel="noopener">Helm</a>是kubernetes的官方包管理工具。根据官网上的描述<code>Helm is the best way to find, share, and use software built for Kubernetes.</code>可以看出helm在kubernetes社区中的定位。</p><p>这篇文章并不是helm的入门文章，而是着重于如何在本地开发chart。希望进行helm入门的同学可以参考官方文档。</p><a id="more"></a><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>本文会分为两个部分来探讨如何在本地开发chart，分别是：</p><ul><li>Chart的规范</li><li>Helm提供的本地开发功能</li></ul><h1 id="Chart的规范"><a href="#Chart的规范" class="headerlink" title="Chart的规范"></a>Chart的规范</h1><p>根据定义，一个Chart是一些有相关性的Kubernetes资源的集合。一个chart可以是一个简单的应用，比如memcached，或者是一个复杂的集合，比如一个full-stack的web的应用，含有server，ui，database，cache等等。</p><p>Chart从本质上只不过是一些文件，不过这些文件需要满足一定的规范，比如目录的规范和文件名的规范。</p><h2 id="Chart的目录结构"><a href="#Chart的目录结构" class="headerlink" title="Chart的目录结构"></a>Chart的目录结构</h2><p>根据规定，符合如下目录结构的目录就是一个Chart，目录名即为Chart名（不包含版本信息）：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wordpress/</span><br><span class="line">  Chart.yaml          <span class="comment"># A YAML file containing information about the chart</span></span><br><span class="line">  LICENSE             <span class="comment"># OPTIONAL: A plain text file containing the license for the chart</span></span><br><span class="line">  README.md           <span class="comment"># OPTIONAL: A human-readable README file</span></span><br><span class="line">  requirements.yaml   <span class="comment"># OPTIONAL: A YAML file listing dependencies for the chart</span></span><br><span class="line">  values.yaml         <span class="comment"># The default configuration values for this chart</span></span><br><span class="line">  charts/             <span class="comment"># OPTIONAL: A directory containing any charts upon which this chart depends.</span></span><br><span class="line">  templates/          <span class="comment"># OPTIONAL: A directory of templates that, when combined with values,</span></span><br><span class="line">                      <span class="comment"># will generate valid Kubernetes manifest files.</span></span><br><span class="line">  templates/NOTES.txt <span class="comment"># OPTIONAL: A plain text file containing short usage notes</span></span><br></pre></td></tr></table></figure><p>虽然这里看到charts和templates文件夹都是optional的，但是至少需要有一个存在，chart才是合法的。</p><h2 id="Chart-yaml文件"><a href="#Chart-yaml文件" class="headerlink" title="Chart.yaml文件"></a>Chart.yaml文件</h2><p>每个Chart都必须有一个<code>Chart.yaml</code>文件，这个文件的内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">The</span> <span class="string">name</span> <span class="string">of</span> <span class="string">the</span> <span class="string">chart</span> <span class="string">(required)</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">A</span> <span class="string">SemVer</span> <span class="number">2</span> <span class="string">version</span> <span class="string">(required)</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">A</span> <span class="string">single-sentence</span> <span class="string">description</span> <span class="string">of</span> <span class="string">this</span> <span class="string">project</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">keywords</span> <span class="string">about</span> <span class="string">this</span> <span class="string">project</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">home:</span> <span class="string">The</span> <span class="string">URL</span> <span class="string">of</span> <span class="string">this</span> <span class="string">project's</span> <span class="string">home</span> <span class="string">page</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">sources:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">URLs</span> <span class="string">to</span> <span class="string">source</span> <span class="string">code</span> <span class="string">for</span> <span class="string">this</span> <span class="string">project</span> <span class="string">(optional)</span></span><br><span class="line"><span class="attr">maintainers:</span> <span class="comment"># (optional)</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">The</span> <span class="string">maintainer's</span> <span class="string">name</span> <span class="string">(required</span> <span class="string">for</span> <span class="string">each</span> <span class="string">maintainer)</span></span><br><span class="line"><span class="attr">    email:</span> <span class="string">The</span> <span class="string">maintainer's</span> <span class="string">email</span> <span class="string">(optional</span> <span class="string">for</span> <span class="string">each</span> <span class="string">maintainer)</span></span><br><span class="line"><span class="attr">    url:</span> <span class="string">A</span> <span class="string">URL</span> <span class="string">for</span> <span class="string">the</span> <span class="string">maintainer</span> <span class="string">(optional</span> <span class="string">for</span> <span class="string">each</span> <span class="string">maintainer)</span></span><br><span class="line"><span class="attr">engine:</span> <span class="string">gotpl</span> <span class="comment"># The name of the template engine (optional, defaults to gotpl)</span></span><br><span class="line"><span class="attr">icon:</span> <span class="string">A</span> <span class="string">URL</span> <span class="string">to</span> <span class="string">an</span> <span class="string">SVG</span> <span class="string">or</span> <span class="string">PNG</span> <span class="string">image</span> <span class="string">to</span> <span class="string">be</span> <span class="string">used</span> <span class="string">as</span> <span class="string">an</span> <span class="string">icon</span> <span class="string">(optional).</span></span><br><span class="line"><span class="attr">appVersion:</span> <span class="string">The</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">app</span> <span class="string">that</span> <span class="string">this</span> <span class="string">contains</span> <span class="string">(optional).</span> <span class="string">This</span> <span class="string">needn't</span> <span class="string">be</span> <span class="string">SemVer.</span></span><br><span class="line"><span class="attr">deprecated:</span> <span class="string">Whether</span> <span class="string">or</span> <span class="string">not</span> <span class="string">this</span> <span class="string">chart</span> <span class="string">is</span> <span class="string">deprecated</span> <span class="string">(optional,</span> <span class="string">boolean)</span></span><br><span class="line"><span class="attr">tillerVersion:</span> <span class="string">The</span> <span class="string">version</span> <span class="string">of</span> <span class="string">Tiller</span> <span class="string">that</span> <span class="string">this</span> <span class="string">chart</span> <span class="string">requires.</span> <span class="string">This</span> <span class="string">should</span> <span class="string">be</span> <span class="string">expressed</span> <span class="string">as</span> <span class="string">a</span> <span class="string">SemVer</span> <span class="attr">range:</span> <span class="string">"&gt;2.0.0"</span> <span class="string">(optional)</span></span><br></pre></td></tr></table></figure><h2 id="Chart的版本"><a href="#Chart的版本" class="headerlink" title="Chart的版本"></a>Chart的版本</h2><p>每个Chart都必须有一个版本号，版本号必须遵守<a href="http://semver.org/" target="_blank" rel="noopener">语义化版本规范V2</a>。每个package（Chart打包后的东西）同时由name和version来唯一确定。</p><p>比如，一个叫做<code>nginx</code>的版本为<code>1.2.3</code>的Chart，打包后就是<code>nginx-1.2.3.tgz</code>。</p><p>更复杂的语义化版本号是被支持的，比如<code>version: 1.2.3-alpha.1+ef365</code>但是非语义化的版本是不被允许的。</p><p>Helm和Tiller都会使用Chart的名称+版本来唯一标识一个package，所以Chart.yaml里面的版本一定要对应package的文件名。</p><h2 id="appVersion"><a href="#appVersion" class="headerlink" title="appVersion"></a>appVersion</h2><p>appVersion其实并没啥用，只是指定了Chart包含的应用的版本，对helm和tiller来说并不会有啥影响，也不需要和Chart的version一致。自己随便写都可以……</p><h2 id="Deprecating-Chart"><a href="#Deprecating-Chart" class="headerlink" title="Deprecating Chart"></a>Deprecating Chart</h2><p>可以通过在<code>Chart.yaml</code>里面把<code>deprecated</code>设为<code>true</code>来标识一个Chart已经是deprecated状态。</p><h2 id="License，ReadME和Notes"><a href="#License，ReadME和Notes" class="headerlink" title="License，ReadME和Notes"></a>License，ReadME和Notes</h2><p>一个Chart还可以有License来标识License信息，README.md来包含一些介绍信息，以及一个templates/NOTES.txt文件来指导如何去安装或者使用。</p><p>templates/NOTES.txt文件会被当做普通的template来对待（意味着其中可以有变量），并且会在每次<code>helm status</code>之后和<code>helm install</code>之后被打印到STDOUT。</p><p>比如<code>stable/mysql</code>的NOTES.txt如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">MySQL can be accessed via<span class="built_in"> port </span>3306 on the following<span class="built_in"> DNS </span>name <span class="keyword">from</span> within your cluster:</span><br><span class="line">&#123;&#123; template <span class="string">"mysql.fullname"</span> . &#125;&#125;.&#123;&#123; .Release.Namespace &#125;&#125;.svc.cluster.local</span><br><span class="line"></span><br><span class="line"><span class="keyword">To</span> <span class="builtin-name">get</span> your root password run:</span><br><span class="line"></span><br><span class="line">    <span class="attribute">MYSQL_ROOT_PASSWORD</span>=$(kubectl <span class="builtin-name">get</span><span class="built_in"> secret </span>--namespace &#123;&#123; .Release.Namespace &#125;&#125; &#123;&#123; template <span class="string">"mysql.fullname"</span> . &#125;&#125; -o <span class="attribute">jsonpath</span>=<span class="string">"&#123;.data.mysql-root-password&#125;"</span> | base64 --decode; echo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">To</span> connect <span class="keyword">to</span> your database:</span><br><span class="line"></span><br><span class="line">1. <span class="builtin-name">Run</span> an Ubuntu pod that you can use as a client:</span><br><span class="line"></span><br><span class="line">    kubectl <span class="builtin-name">run</span> -i --tty ubuntu <span class="attribute">--image</span>=ubuntu:16.04 <span class="attribute">--restart</span>=Never -- bash -il</span><br><span class="line"></span><br><span class="line">2. Install the mysql client:</span><br><span class="line"></span><br><span class="line">    $ apt-<span class="builtin-name">get</span> update &amp;&amp; apt-<span class="builtin-name">get</span> install mysql-client -y</span><br><span class="line"></span><br><span class="line">3. Connect using the mysql cli, then provide your password:</span><br><span class="line">    $ mysql -h &#123;&#123; template <span class="string">"mysql.fullname"</span> . &#125;&#125; -p</span><br><span class="line"></span><br><span class="line"><span class="keyword">To</span> connect <span class="keyword">to</span> your database directly <span class="keyword">from</span> outside the K8s cluster:</span><br><span class="line">    &#123;&#123;- <span class="keyword">if</span> contains <span class="string">"NodePort"</span> .Values.service.type &#125;&#125;</span><br><span class="line">    <span class="attribute">MYSQL_HOST</span>=$(kubectl <span class="builtin-name">get</span> nodes --namespace &#123;&#123; .Release.Namespace &#125;&#125; -o <span class="attribute">jsonpath</span>=<span class="string">'&#123;.items[0].status.addresses[0].address&#125;'</span>)</span><br><span class="line">    <span class="attribute">MYSQL_PORT</span>=$(kubectl <span class="builtin-name">get</span> svc --namespace &#123;&#123; .Release.Namespace &#125;&#125; &#123;&#123; template <span class="string">"mysql.fullname"</span> . &#125;&#125; -o <span class="attribute">jsonpath</span>=<span class="string">'&#123;.spec.ports[0].nodePort&#125;'</span>)</span><br><span class="line"></span><br><span class="line">    &#123;&#123;- <span class="keyword">else</span> <span class="keyword">if</span> contains <span class="string">"ClusterIP"</span> .Values.service.type &#125;&#125;</span><br><span class="line">    <span class="attribute">MYSQL_HOST</span>=127.0.0.1</span><br><span class="line">    MYSQL_PORT=&#123;&#123;<span class="built_in"> default </span><span class="string">"3306"</span> .Values.service.port &#125;&#125;</span><br><span class="line"></span><br><span class="line">    # Execute the following commands <span class="keyword">to</span><span class="built_in"> route </span>the connection:</span><br><span class="line">    <span class="builtin-name">export</span> <span class="attribute">POD_NAME</span>=$(kubectl <span class="builtin-name">get</span> pods --namespace &#123;&#123; .Release.Namespace &#125;&#125; -l <span class="string">"app=&#123;&#123; template "</span>mysql.fullname<span class="string">" . &#125;&#125;"</span> -o <span class="attribute">jsonpath</span>=<span class="string">"&#123;.items[0].metadata.name&#125;"</span>)</span><br><span class="line">    kubectl port-forward <span class="variable">$POD_NAME</span> &#123;&#123;<span class="built_in"> default </span><span class="string">"3306"</span> .Values.service.port &#125;&#125;:&#123;&#123;<span class="built_in"> default </span><span class="string">"3306"</span> .Values.service.port &#125;&#125;</span><br><span class="line"></span><br><span class="line">    &#123;&#123;- end &#125;&#125;</span><br><span class="line"></span><br><span class="line">    mysql -h <span class="variable">$&#123;MYSQL_HOST&#125;</span> -P<span class="variable">$&#123;MYSQL_PORT&#125;</span> -u root -p<span class="variable">$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br></pre></td></tr></table></figure><p>可以看出来，NOTES.txt是用来给用户作使用上的指导的。</p><h2 id="Chart的依赖"><a href="#Chart的依赖" class="headerlink" title="Chart的依赖"></a>Chart的依赖</h2><p>我们都知道，软件开发过程中，复用是一个很重要的概念，同样的，Chart也可以依赖于其它的Chart，可以复用其它的Chart的内容。</p><h3 id="使用requirements-yaml"><a href="#使用requirements-yaml" class="headerlink" title="使用requirements.yaml"></a>使用requirements.yaml</h3><p>Helm提供了两种对Chart复用的方法，第一种是在<code>requirements.yaml</code>中指定依赖的Chart，如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">apache</span></span><br><span class="line"><span class="attr">    version:</span> <span class="number">1.2</span><span class="number">.3</span></span><br><span class="line"><span class="attr">    repository:</span> <span class="attr">http://example.com/charts</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">    version:</span> <span class="number">3.2</span><span class="number">.1</span></span><br><span class="line"><span class="attr">    repository:</span> <span class="attr">http://another.example.com/charts</span></span><br></pre></td></tr></table></figure><p>如果说需要对一个chart复用多次，可以这么干：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parentchart/requirements.yaml</span></span><br><span class="line"><span class="attr">dependencies:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">subchart</span></span><br><span class="line"><span class="attr">    repository:</span> <span class="attr">http://localhost:10191</span></span><br><span class="line"><span class="attr">    version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line"><span class="attr">    alias:</span> <span class="string">new-subchart-1</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">subchart</span></span><br><span class="line"><span class="attr">    repository:</span> <span class="attr">http://localhost:10191</span></span><br><span class="line"><span class="attr">    version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line"><span class="attr">    alias:</span> <span class="string">new-subchart-2</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">subchart</span></span><br><span class="line"><span class="attr">    repository:</span> <span class="attr">http://localhost:10191</span></span><br><span class="line"><span class="attr">    version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p>除此之外，Helm还可以选择性的去使用依赖的chart，具体可以参考<a href="https://docs.helm.sh/developing_charts/#tags-and-condition-fields-in-requirements-yaml" target="_blank" rel="noopener">tags and condition</a>。</p><h3 id="直接使用charts来手动管理"><a href="#直接使用charts来手动管理" class="headerlink" title="直接使用charts来手动管理"></a>直接使用charts来手动管理</h3><p>第二种是直接把需要用的Chart放到<code>charts</code>文件夹下。一般情况下推荐使用第一种，第二种是在需要对依赖的chart做魔改的情况下用到的。</p><p>Helm还提供了<code>helm dep</code>这个命令来方便对依赖的管理，之后会介绍到。</p><h3 id="依赖的一些实现细节"><a href="#依赖的一些实现细节" class="headerlink" title="依赖的一些实现细节"></a>依赖的一些实现细节</h3><p>在<code>helm install</code>和<code>helm upgrade</code>的时候，helm会把依赖和当前chart打包成一个集合一起送给tiller，然后（目前是）按照类型+字母顺序来apply，并不是先去install依赖再去install当前的chart。</p><p>例如，我们有一个chart，会有以下三个东西：</p><ul><li>namespace “A-Namespace”</li><li>statefulset “A-StatefulSet”</li><li>service “A-Service”</li></ul><p>这个chart依赖于另一个chart，有如下三个东西：</p><ul><li>namespace “B-Namespace”</li><li>replicaset “B-ReplicaSet”</li><li>service “B-Service”</li></ul><p>那么在安装或者升级的过程中，顺序如下：</p><ul><li>A-Namespace</li><li>B-Namespace</li><li>A-StatefulSet</li><li>B-ReplicaSet</li><li>A-Service</li><li>B-Service</li></ul><h1 id="Helm客户端提供的和本地开发相关的功能"><a href="#Helm客户端提供的和本地开发相关的功能" class="headerlink" title="Helm客户端提供的和本地开发相关的功能"></a>Helm客户端提供的和本地开发相关的功能</h1><p>Helm的客户端提供了一些和本地开发相关的命令，这里简单介绍一下。</p><h2 id="helm-completion"><a href="#helm-completion" class="headerlink" title="helm completion"></a>helm completion</h2><p>顾名思义，提供了命令补全，使用方式也比较简单：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> &lt;(helm completion zsh)</span></span><br></pre></td></tr></table></figure><h2 id="helm-create"><a href="#helm-create" class="headerlink" title="helm create"></a>helm create</h2><p>可以通过这个命令直接创建出一个符合Chart规范的目录出来，比如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> helm create myweb</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tree myweb</span></span><br><span class="line">myweb</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── charts</span><br><span class="line">├── templates</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   └── service.yaml</span><br><span class="line">└── values.yaml</span><br><span class="line"></span><br><span class="line">2 directories, 7 files</span><br></pre></td></tr></table></figure><h2 id="helm-dependency"><a href="#helm-dependency" class="headerlink" title="helm dependency"></a>helm dependency</h2><p>顾名思义，是用来进行依赖管理的，可以被简写为<code>helm dep</code>，具体使用如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> helm dep</span></span><br><span class="line">Manage the dependencies of a chart.</span><br><span class="line"></span><br><span class="line">Helm charts store their dependencies in 'charts/'. For chart developers, it is</span><br><span class="line">often easier to manage a single dependency file ('requirements.yaml')</span><br><span class="line">which declares all dependencies.</span><br><span class="line"></span><br><span class="line">The dependency commands operate on that file, making it easy to synchronize</span><br><span class="line">between the desired dependencies and the actual dependencies stored in the</span><br><span class="line">'charts/' directory.</span><br><span class="line"></span><br><span class="line">A 'requirements.yaml' file is a YAML file in which developers can declare chart</span><br><span class="line">dependencies, along with the location of the chart and the desired version.</span><br><span class="line">For example, this requirements file declares two dependencies:</span><br><span class="line"></span><br><span class="line">    # requirements.yaml</span><br><span class="line">    dependencies:</span><br><span class="line">    - name: nginx</span><br><span class="line">      version: "1.2.3"</span><br><span class="line">      repository: "https://example.com/charts"</span><br><span class="line">    - name: memcached</span><br><span class="line">      version: "3.2.1"</span><br><span class="line">      repository: "https://another.example.com/charts"</span><br><span class="line"></span><br><span class="line">The 'name' should be the name of a chart, where that name must match the name</span><br><span class="line">in that chart's 'Chart.yaml' file.</span><br><span class="line"></span><br><span class="line">The 'version' field should contain a semantic version or version range.</span><br><span class="line"></span><br><span class="line">The 'repository' URL should point to a Chart Repository. Helm expects that by</span><br><span class="line">appending '/index.yaml' to the URL, it should be able to retrieve the chart</span><br><span class="line">repository's index. Note: 'repository' can be an alias. The alias must start</span><br><span class="line">with 'alias:' or '@'.</span><br><span class="line"></span><br><span class="line">Starting from 2.2.0, repository can be defined as the path to the directory of</span><br><span class="line">the dependency charts stored locally. The path should start with a prefix of</span><br><span class="line">"file://". For example,</span><br><span class="line"></span><br><span class="line">    # requirements.yaml</span><br><span class="line">    dependencies:</span><br><span class="line">    - name: nginx</span><br><span class="line">      version: "1.2.3"</span><br><span class="line">      repository: "file://../dependency_chart/nginx"</span><br><span class="line"></span><br><span class="line">If the dependency chart is retrieved locally, it is not required to have the</span><br><span class="line">repository added to helm by "helm add repo". Version matching is also supported</span><br><span class="line">for this case.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  helm dependency [command]</span><br><span class="line"></span><br><span class="line">Aliases:</span><br><span class="line">  dependency, dep, dependencies</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  build       rebuild the charts/ directory based on the requirements.lock file</span><br><span class="line">  list        list the dependencies for the given chart</span><br><span class="line">  update      update charts/ based on the contents of requirements.yaml</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -h, --help   help for dependency</span><br><span class="line"></span><br><span class="line">Use "helm dependency [command] --help" for more information about a command.</span><br></pre></td></tr></table></figure><h2 id="helm-fetch"><a href="#helm-fetch" class="headerlink" title="helm fetch"></a>helm fetch</h2><p>一看这就是个下载别的chart的命令，为啥我要说和本地开发有关系呢？</p><p>因为我认为，helm的官方repo里面的chart最大的作用就是作为一个best practice来展示给使用者一个示例。</p><p>所以，当不知道该怎么写的时候，去抄吧😁。</p><h2 id="helm-lint"><a href="#helm-lint" class="headerlink" title="helm lint"></a>helm lint</h2><p>顾名思义，用来检查一个Chart是否存在问题。</p><p>如果说有错误，会报出error，并返回非零值。</p><p>我们就用刚才的myweb来试手：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> helm lint myweb</span></span><br><span class="line">==&gt; Linting myweb</span><br><span class="line">[INFO] Chart.yaml: icon is recommended</span><br><span class="line"></span><br><span class="line">1 chart(s) linted, no failures</span><br></pre></td></tr></table></figure><h2 id="helm-package"><a href="#helm-package" class="headerlink" title="helm package"></a>helm package</h2><p>这个命令是当一个chart写完后用来把一个chart打包成<code>chartName-version.tgz</code>的。一般只有在发布的时候使用，提供了比较多的功能，比如sign之类的，如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> helm package --<span class="built_in">help</span></span></span><br><span class="line">This command packages a chart into a versioned chart archive file. If a path</span><br><span class="line">is given, this will look at that path for a chart (which must contain a</span><br><span class="line">Chart.yaml file) and then package that directory.</span><br><span class="line"></span><br><span class="line">If no path is given, this will look in the present working directory for a</span><br><span class="line">Chart.yaml file, and (if found) build the current directory into a chart.</span><br><span class="line"></span><br><span class="line">Versioned chart archives are used by Helm package repositories.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  helm package [flags] [CHART_PATH] [...]</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -u, --dependency-update    update dependencies from "requirements.yaml" to dir "charts/" before packaging</span><br><span class="line">  -d, --destination string   location to write the chart. (default ".")</span><br><span class="line">      --key string           name of the key to use when signing. Used if --sign is true</span><br><span class="line">      --keyring string       location of a public keyring (default "/Users/daniel/.gnupg/pubring.gpg")</span><br><span class="line">      --save                 save packaged chart to local chart repository (default true)</span><br><span class="line">      --sign                 use a PGP private key to sign this package</span><br><span class="line">      --version string       set the version on the chart to this semver version</span><br></pre></td></tr></table></figure><p>我们还是用刚才的myweb作为例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> helm package myweb</span></span><br><span class="line">Successfully packaged chart and saved it to: /Users/daniel/Works/k8s/helm/myweb-0.1.0.tgz</span><br></pre></td></tr></table></figure><h2 id="helm-serve"><a href="#helm-serve" class="headerlink" title="helm serve"></a>helm serve</h2><p>这个命令是用来在本地开启一个repo server的，可以用来本地测试使用。</p><h2 id="helm-template"><a href="#helm-template" class="headerlink" title="helm template"></a>helm template</h2><p>这个命令可以在本地渲染出template来检查是否正确，具体使用如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> helm template --<span class="built_in">help</span></span></span><br><span class="line">Render chart templates locally and display the output.</span><br><span class="line"></span><br><span class="line">This does not require Tiller. However, any values that would normally be</span><br><span class="line">looked up or retrieved in-cluster will be faked locally. Additionally, none</span><br><span class="line">of the server-side testing of chart validity (e.g. whether an API is supported)</span><br><span class="line">is done.</span><br><span class="line"></span><br><span class="line">To render just one template in a chart, use '-x':</span><br><span class="line"></span><br><span class="line"><span class="meta">	$</span><span class="bash"> helm template mychart -x templates/deployment.yaml</span></span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  helm template [flags] CHART</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -x, --execute stringArray    only execute the given templates</span><br><span class="line">      --kube-version string    override the Kubernetes version used as Capabilities.KubeVersion.Major/Minor (e.g. 1.7)</span><br><span class="line">  -n, --name string            release name (default "RELEASE-NAME")</span><br><span class="line">      --name-template string   specify template used to name the release</span><br><span class="line">      --namespace string       namespace to install the release into</span><br><span class="line">      --notes                  show the computed NOTES.txt file as well</span><br><span class="line">      --set stringArray        set values on the command line (can specify multiple or separate values with commas: key1=val1,key2=val2)</span><br><span class="line">  -f, --values valueFiles      specify values in a YAML file (can specify multiple) (default [])</span><br></pre></td></tr></table></figure><p>我们仍然以myweb作为例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> helm template myweb</span></span><br><span class="line">---</span><br><span class="line"><span class="meta">#</span><span class="bash"> Source: myweb/templates/service.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: RELEASE-NAME-myweb</span><br><span class="line">  labels:</span><br><span class="line">    app: myweb</span><br><span class="line">    chart: myweb-0.1.0</span><br><span class="line">    release: RELEASE-NAME</span><br><span class="line">    heritage: Tiller</span><br><span class="line">spec:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  ports:</span><br><span class="line">    - port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      protocol: TCP</span><br><span class="line">      name: nginx</span><br><span class="line">  selector:</span><br><span class="line">    app: myweb</span><br><span class="line">    release: RELEASE-NAME</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="meta">#</span><span class="bash"> Source: myweb/templates/deployment.yaml</span></span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: RELEASE-NAME-myweb</span><br><span class="line">  labels:</span><br><span class="line">    app: myweb</span><br><span class="line">    chart: myweb-0.1.0</span><br><span class="line">    release: RELEASE-NAME</span><br><span class="line">    heritage: Tiller</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: myweb</span><br><span class="line">        release: RELEASE-NAME</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: myweb</span><br><span class="line">          image: "nginx:stable"</span><br><span class="line">          imagePullPolicy: IfNotPresent</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">          livenessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: /</span><br><span class="line">              port: 80</span><br><span class="line">          readinessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              path: /</span><br><span class="line">              port: 80</span><br><span class="line">          resources:</span><br><span class="line">            &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="meta">#</span><span class="bash"> Source: myweb/templates/ingress.yaml</span></span><br></pre></td></tr></table></figure><h2 id="helm-verify"><a href="#helm-verify" class="headerlink" title="helm verify"></a>helm verify</h2><p>这个命令是用来验证一个给定的chart是否被sign。在对安全性要求高的环境下有用。</p><h2 id="helm-plugin"><a href="#helm-plugin" class="headerlink" title="helm plugin"></a>helm plugin</h2><p>最后是这个<code>helm plugin</code>，看到这个我们就能感觉到，helm瞬间有了无数的扩展性，需要什么功能如果helm不提供咱们就自己干一个加上去。</p><p>helm目前现在已经有了一些比较好的plugin，比如有一个plugin支持用template render出来之后再进行验证查错之类的。</p><p>如果有一些别的定制化的需求也可以通过自己写个plugin来完成。</p></div><div id="reward-container"><div>请博主喝杯咖啡~</div> <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> Donate</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="https://static.purewhite.io/wechat_pay.jpeg" alt="Pure White WeChat Pay"><p>WeChat Pay</p></div><div style="display:inline-block"> <img src="https://static.purewhite.io/alipay.jpeg" alt="Pure White Alipay"><p>Alipay</p></div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/kubernetes/" rel="tag"># kubernetes</a> <a href="/tags/运维/" rel="tag"># 运维</a> <a href="/tags/后端/" rel="tag"># 后端</a> <a href="/tags/架构/" rel="tag"># 架构</a> <a href="/tags/docker/" rel="tag"># docker</a> <a href="/tags/linux/" rel="tag"># linux</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/01/17/helm-provide-value/" rel="next" title="Helm中如何传递value"><i class="fa fa-chevron-left"></i> Helm中如何传递value</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/03/30/lintcode-longest-palindrome/" rel="prev" title="LintCode 627.最长回文串">LintCode 627.最长回文串<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc" data-target="post-toc-wrap"> Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chart的规范"><span class="nav-number">2.</span> <span class="nav-text">Chart的规范</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Chart的目录结构"><span class="nav-number">2.1.</span> <span class="nav-text">Chart的目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chart-yaml文件"><span class="nav-number">2.2.</span> <span class="nav-text">Chart.yaml文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chart的版本"><span class="nav-number">2.3.</span> <span class="nav-text">Chart的版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#appVersion"><span class="nav-number">2.4.</span> <span class="nav-text">appVersion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deprecating-Chart"><span class="nav-number">2.5.</span> <span class="nav-text">Deprecating Chart</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#License，ReadME和Notes"><span class="nav-number">2.6.</span> <span class="nav-text">License，ReadME和Notes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chart的依赖"><span class="nav-number">2.7.</span> <span class="nav-text">Chart的依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用requirements-yaml"><span class="nav-number">2.7.1.</span> <span class="nav-text">使用requirements.yaml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#直接使用charts来手动管理"><span class="nav-number">2.7.2.</span> <span class="nav-text">直接使用charts来手动管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖的一些实现细节"><span class="nav-number">2.7.3.</span> <span class="nav-text">依赖的一些实现细节</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Helm客户端提供的和本地开发相关的功能"><span class="nav-number">3.</span> <span class="nav-text">Helm客户端提供的和本地开发相关的功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-completion"><span class="nav-number">3.1.</span> <span class="nav-text">helm completion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-create"><span class="nav-number">3.2.</span> <span class="nav-text">helm create</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-dependency"><span class="nav-number">3.3.</span> <span class="nav-text">helm dependency</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-fetch"><span class="nav-number">3.4.</span> <span class="nav-text">helm fetch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-lint"><span class="nav-number">3.5.</span> <span class="nav-text">helm lint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-package"><span class="nav-number">3.6.</span> <span class="nav-text">helm package</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-serve"><span class="nav-number">3.7.</span> <span class="nav-text">helm serve</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-template"><span class="nav-number">3.8.</span> <span class="nav-text">helm template</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-verify"><span class="nav-number">3.9.</span> <span class="nav-text">helm verify</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#helm-plugin"><span class="nav-number">3.10.</span> <span class="nav-text">helm plugin</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://static.purewhite.io/avatar.jpg" alt="Pure White"><p class="site-author-name" itemprop="name">Pure White</p><div class="site-description" itemprop="description">青春不是年华，是心境；<br>青春不是桃面、丹唇、柔膝，<br>而是深沉的意志、恢弘的想象、<br>炽热的感情。</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">48</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/PureWhiteWu" title="GitHub &rarr; https://github.com/PureWhiteWu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:daniel48@126.com" title="E-Mail &rarr; mailto:daniel48@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://twitter.com/PureWhite_Wu" title="Twitter &rarr; https://twitter.com/PureWhite_Wu" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span><span class="links-of-author-item"><a href="https://www.linkedin.com/in/%E8%BF%AA-%E5%90%B4-846051106/" title="LinkedIn &rarr; https://www.linkedin.com/in/%E8%BF%AA-%E5%90%B4-846051106/" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a></span><span class="links-of-author-item"><a href="https://telegram.me/PureWhiteWu" title="Telegram &rarr; https://telegram.me/PureWhiteWu" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i> Telegram</a></span><span class="links-of-author-item"><a href="http://weibo.com/purewhitewu" title="微博 &rarr; http://weibo.com/purewhitewu" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> 微博</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/PureWhite_Wu" title="知乎 &rarr; https://www.zhihu.com/people/PureWhite_Wu" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://static.purewhite.io/wechat.jpeg" title="微信 &rarr; https://static.purewhite.io/wechat.jpeg" rel="noopener" target="_blank"><i class="fa fa-fw fa-weixin"></i> 微信</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://blog.didispace.com/" title="http://blog.didispace.com/" rel="noopener" target="_blank">程序猿DD</a></li><li class="links-of-blogroll-item"> <a href="http://www.v2ex.com/?r=PureWhiteWu" title="http://www.v2ex.com/?r=PureWhiteWu" rel="noopener" target="_blank">v2ex</a></li><li class="links-of-blogroll-item"> <a href="https://yuzhouwan.com/" title="https://yuzhouwan.com/" rel="noopener" target="_blank">宇宙湾</a></li><li class="links-of-blogroll-item"> <a href="https://pengrl.com/" title="https://pengrl.com/" rel="noopener" target="_blank">yoko blog</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"><a href="http://www.beian.miit.gov.cn" rel="noopener" target="_blank">沪ICP备15051443号-3</a><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=" rel="noopener" target="_blank"></a> &copy; 2017 – <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Pure White</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Symbols count total:</span> <span title="Symbols count total">136k</span></div><div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div> <span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.3.0</div><script pjax>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
              leancloudSelector(url).innerText = counter.time + 1;
            
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.log('Failed to create', error);
                });
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=Sa9GIjpR90eFliBWzUAiUp9W-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'Sa9GIjpR90eFliBWzUAiUp9W-gzGzoHsz',
            'X-LC-Key': 'rSpeP2HoYIdOYJr4p2elMvLn',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script><script pjax>!function(){var e=document.createElement("script");e.src="//tajs.qq.com/stats?sId=61888292";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></footer></div><script src="/lib/jquery/index.js?v=3.4.1"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script><script src="/js/bookmark.js?v=7.3.0"></script><script src="/js/schemes/muse.js?v=7.3.0"></script><script src="/js/next-boot.js?v=7.3.0"></script><script pjax>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>function fbAsyncInit(){FB.init({appId:"761738893983932",xfbml:!0,version:"v3.3"})}!function(e,n,t){var c,o=e.getElementsByTagName(n)[0];e.getElementById(t)||((c=e.createElement(n)).id=t,c.src="//connect.facebook.net/zh_Hans/sdk.js",o.parentNode.insertBefore(c,o))}(document,"script","facebook-jssdk")</script><script pjax>CONFIG.page.isPost&&(wpac_init=window.wpac_init||[],wpac_init.push({widget:"Rating",id:8500,el:"wpac-rating",color:"fc6423"}),function(){if(!("WIDGETPACK_LOADED"in window)){WIDGETPACK_LOADED=!0;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//embed.widgetpack.com/widget.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t.nextSibling)}}())</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css"><script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js"></script><script src="/js/algolia-search.js?v=7.3.0"></script><div id="pjax"><script>function loadCount(){var d=document,t=d.createElement("script");t.src="https://blog-zr0zqnlt9p.disqus.com/count.js",t.id="dsq-count-scr",(d.head||d.body).appendChild(t)}window.addEventListener("load",loadCount,!1)</script><script>
  function disqus_config() {
    this.page.url = "https://purewhite.io/2018/01/17/helm-local-dev/";
    this.page.identifier = "2018/01/17/helm-local-dev/";
    this.page.title = '如何使用Helm进行本地开发';};
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://blog-zr0zqnlt9p.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    (function() {
      var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        window.addEventListener('load', loadComments, false);
      } else {
        var disqus_scroll = () => {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
          var scrollTop = window.scrollY;

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            window.removeEventListener('scroll', disqus_scroll);
            loadComments();
          }
        };
        window.addEventListener('scroll', disqus_scroll);
      }
    })();
  
</script></div><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo: !CONFIG.bookmark.enable
});
window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    $(element).parent().append($(element).remove());
  });
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script></body></html>